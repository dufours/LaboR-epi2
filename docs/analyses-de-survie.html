<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 9 Analyses de survie | Épidémiologie 2 - Labo informatique R (PTM-6675)</title>
  <meta name="description" content="Chapitre 10" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 9 Analyses de survie | Épidémiologie 2 - Labo informatique R (PTM-6675)" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapitre 10" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 9 Analyses de survie | Épidémiologie 2 - Labo informatique R (PTM-6675)" />
  
  <meta name="twitter:description" content="Chapitre 10" />
  

<meta name="author" content="Simon Dufour (Professeur à la Faculté de Médecine vétérinaire de l’Université de Montréal)" />


<meta name="date" content="2023-01-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="régression-pour-données-de-compte-et-dincidence.html"/>
<link rel="next" href="modèles-mixtes-pour-données-structurées.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Épidémiologie 2 - Labo informatique R (PTM-6675)</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> À propos</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#spécificités-de-r"><i class="fa fa-check"></i><b>1.1</b> Spécificités de R</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html"><i class="fa fa-check"></i><b>2</b> Bonnes pratiques de gestion de projet</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html#organiser-son-projet-de-recherche"><i class="fa fa-check"></i><b>2.1</b> Organiser son projet de recherche</a></li>
<li class="chapter" data-level="2.2" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html#où-sauvegarder-son-projet"><i class="fa fa-check"></i><b>2.2</b> Où sauvegarder son projet</a></li>
<li class="chapter" data-level="2.3" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html#où-sauvegarder-ses-données"><i class="fa fa-check"></i><b>2.3</b> Où sauvegarder ses données</a></li>
<li class="chapter" data-level="2.4" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html#scripts-danalyse"><i class="fa fa-check"></i><b>2.4</b> Scripts d’analyse</a></li>
<li class="chapter" data-level="2.5" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html#les-projets-r"><i class="fa fa-check"></i><b>2.5</b> Les projets R</a></li>
<li class="chapter" data-level="2.6" data-path="bonnes-pratiques-de-gestion-de-projet.html"><a href="bonnes-pratiques-de-gestion-de-projet.html#copies-de-sécurité"><i class="fa fa-check"></i><b>2.6</b> Copies de sécurité</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="obtention-des-données-pour-les-travaux-pratiques.html"><a href="obtention-des-données-pour-les-travaux-pratiques.html"><i class="fa fa-check"></i><b>3</b> Obtention des données pour les travaux pratiques</a></li>
<li class="chapter" data-level="4" data-path="aide-de-r.html"><a href="aide-de-r.html"><i class="fa fa-check"></i><b>4</b> Aide de R</a></li>
<li class="chapter" data-level="5" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>5</b> R Markdown</a></li>
<li class="chapter" data-level="6" data-path="régression-linéaire.html"><a href="régression-linéaire.html"><i class="fa fa-check"></i><b>6</b> Régression linéaire</a>
<ul>
<li class="chapter" data-level="6.1" data-path="régression-linéaire.html"><a href="régression-linéaire.html#généralités"><i class="fa fa-check"></i><b>6.1</b> Généralités</a></li>
<li class="chapter" data-level="6.2" data-path="régression-linéaire.html"><a href="régression-linéaire.html#ajouter-des-intervalles-de-confiance"><i class="fa fa-check"></i><b>6.2</b> Ajouter des intervalles de confiance</a></li>
<li class="chapter" data-level="6.3" data-path="régression-linéaire.html"><a href="régression-linéaire.html#test-de-f-pour-comparer-modèles-complet-vs.-réduit"><i class="fa fa-check"></i><b>6.3</b> Test de <em>F</em> pour comparer modèles complet <em>vs.</em> réduit</a></li>
<li class="chapter" data-level="6.4" data-path="régression-linéaire.html"><a href="régression-linéaire.html#transformer-une-variable"><i class="fa fa-check"></i><b>6.4</b> Transformer une variable</a></li>
<li class="chapter" data-level="6.5" data-path="régression-linéaire.html"><a href="régression-linéaire.html#choisir-la-valeur-de-référence-pour-une-variable-catégorique"><i class="fa fa-check"></i><b>6.5</b> Choisir la valeur de référence pour une variable catégorique</a></li>
<li class="chapter" data-level="6.6" data-path="régression-linéaire.html"><a href="régression-linéaire.html#comparer-les-niveaux-dun-prédicteur-catégorique-avec-2-catégories"><i class="fa fa-check"></i><b>6.6</b> Comparer les niveaux d’un prédicteur catégorique avec &gt;2 catégories</a></li>
<li class="chapter" data-level="6.7" data-path="régression-linéaire.html"><a href="régression-linéaire.html#évaluer-une-interaction-entre-2-variables"><i class="fa fa-check"></i><b>6.7</b> Évaluer une interaction entre 2 variables</a></li>
<li class="chapter" data-level="6.8" data-path="régression-linéaire.html"><a href="régression-linéaire.html#tol-et-vif---évaluer-la-colinéarité"><i class="fa fa-check"></i><b>6.8</b> TOL et VIF - Évaluer la colinéarité</a></li>
<li class="chapter" data-level="6.9" data-path="régression-linéaire.html"><a href="régression-linéaire.html#évaluation-du-modèle"><i class="fa fa-check"></i><b>6.9</b> Évaluation du modèle</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="régression-linéaire.html"><a href="régression-linéaire.html#évaluer-la-linéarité-de-la-relation-à-laide-de-courbes-lissées-pour-prédicteur-quantitatif"><i class="fa fa-check"></i><b>6.9.1</b> Évaluer la linéarité de la relation à l’aide de courbes lissées (pour prédicteur quantitatif)</a></li>
<li class="chapter" data-level="6.9.2" data-path="régression-linéaire.html"><a href="régression-linéaire.html#évaluer-la-linéarité-de-la-relation-à-laide-de-termes-polynomiaux-pour-prédicteur-quantitatif"><i class="fa fa-check"></i><b>6.9.2</b> Évaluer la linéarité de la relation à l’aide de termes polynomiaux (pour prédicteur quantitatif)</a></li>
<li class="chapter" data-level="6.9.3" data-path="régression-linéaire.html"><a href="régression-linéaire.html#méthodes-diagnostiques-pour-les-résiduels"><i class="fa fa-check"></i><b>6.9.3</b> Méthodes diagnostiques pour les résiduels</a></li>
<li class="chapter" data-level="6.9.4" data-path="régression-linéaire.html"><a href="régression-linéaire.html#évaluation-des-observations-extrêmes-etou-influentes"><i class="fa fa-check"></i><b>6.9.4</b> Évaluation des observations extrêmes et/ou influentes</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="régression-linéaire.html"><a href="régression-linéaire.html#travaux-pratiques-1---régression-linéaire---base"><i class="fa fa-check"></i><b>6.10</b> Travaux pratiques 1 - Régression linéaire - Base</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="régression-linéaire.html"><a href="régression-linéaire.html#exercices"><i class="fa fa-check"></i><b>6.10.1</b> Exercices</a></li>
<li class="chapter" data-level="6.10.2" data-path="régression-linéaire.html"><a href="régression-linéaire.html#code-r-et-réponses"><i class="fa fa-check"></i><b>6.10.2</b> Code R et réponses</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="régression-linéaire.html"><a href="régression-linéaire.html#travaux-pratiques-2---régression-linéaire---évaluation-du-modèle"><i class="fa fa-check"></i><b>6.11</b> Travaux pratiques 2 - Régression linéaire - Évaluation du modèle</a>
<ul>
<li class="chapter" data-level="6.11.1" data-path="régression-linéaire.html"><a href="régression-linéaire.html#exercices-1"><i class="fa fa-check"></i><b>6.11.1</b> Exercices</a></li>
<li class="chapter" data-level="6.11.2" data-path="régression-linéaire.html"><a href="régression-linéaire.html#code-r-et-réponses-1"><i class="fa fa-check"></i><b>6.11.2</b> Code R et réponses</a></li>
</ul></li>
<li class="chapter" data-level="6.12" data-path="régression-linéaire.html"><a href="régression-linéaire.html#travaux-pratiques-3---régression-linéaire---construction-de-modèle"><i class="fa fa-check"></i><b>6.12</b> Travaux pratiques 3 - Régression linéaire - Construction de modèle</a>
<ul>
<li class="chapter" data-level="6.12.1" data-path="régression-linéaire.html"><a href="régression-linéaire.html#exercices-2"><i class="fa fa-check"></i><b>6.12.1</b> Exercices</a></li>
<li class="chapter" data-level="6.12.2" data-path="régression-linéaire.html"><a href="régression-linéaire.html#code-r-et-réponses-2"><i class="fa fa-check"></i><b>6.12.2</b> Code R et réponses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="régression-logistique.html"><a href="régression-logistique.html"><i class="fa fa-check"></i><b>7</b> Régression logistique</a>
<ul>
<li class="chapter" data-level="7.1" data-path="régression-logistique.html"><a href="régression-logistique.html#généralités-1"><i class="fa fa-check"></i><b>7.1</b> Généralités</a></li>
<li class="chapter" data-level="7.2" data-path="régression-logistique.html"><a href="régression-logistique.html#effectuer-un-test-de-rapport-de-vraisemblance"><i class="fa fa-check"></i><b>7.2</b> Effectuer un test de rapport de vraisemblance</a></li>
<li class="chapter" data-level="7.3" data-path="régression-logistique.html"><a href="régression-logistique.html#ajouter-des-ic95"><i class="fa fa-check"></i><b>7.3</b> Ajouter des IC95</a></li>
<li class="chapter" data-level="7.4" data-path="régression-logistique.html"><a href="régression-logistique.html#choisir-valeur-de-référence-pour-les-variables-catégoriques"><i class="fa fa-check"></i><b>7.4</b> Choisir valeur de référence pour les variables catégoriques</a></li>
<li class="chapter" data-level="7.5" data-path="régression-logistique.html"><a href="régression-logistique.html#produire-des-tables-de-résultats"><i class="fa fa-check"></i><b>7.5</b> Produire des tables de résultats</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="régression-logistique.html"><a href="régression-logistique.html#présenter-les-rapports-de-cotes-plutôt-que-les-log-odds"><i class="fa fa-check"></i><b>7.5.1</b> Présenter les rapports de cotes plutôt que les log odds</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="régression-logistique.html"><a href="régression-logistique.html#spécifier-pour-quelle-augmentation-dun-prédicteur-continu-le-rapport-de-cotes-est-calculé"><i class="fa fa-check"></i><b>7.6</b> Spécifier pour quelle augmentation d’un prédicteur continu le rapport de cotes est calculé</a></li>
<li class="chapter" data-level="7.7" data-path="régression-logistique.html"><a href="régression-logistique.html#évaluer-une-interaction-entre-2-variables-1"><i class="fa fa-check"></i><b>7.7</b> Évaluer une interaction entre 2 variables</a></li>
<li class="chapter" data-level="7.8" data-path="régression-logistique.html"><a href="régression-logistique.html#comparer-rapports-de-cotes-pour-une-combinaison-spécifique-de-prédicteurs"><i class="fa fa-check"></i><b>7.8</b> Comparer rapports de cotes pour une combinaison spécifique de prédicteurs</a></li>
<li class="chapter" data-level="7.9" data-path="régression-logistique.html"><a href="régression-logistique.html#présenter-leffet-des-prédicteurs-sur-une-échelle-de-probabilité"><i class="fa fa-check"></i><b>7.9</b> Présenter l’effet des prédicteurs sur une échelle de probabilité</a></li>
<li class="chapter" data-level="7.10" data-path="régression-logistique.html"><a href="régression-logistique.html#linéarité-de-la-relation-pour-prédicteur-quantitatif"><i class="fa fa-check"></i><b>7.10</b> Linéarité de la relation (pour prédicteur quantitatif)</a></li>
<li class="chapter" data-level="7.11" data-path="régression-logistique.html"><a href="régression-logistique.html#test-de-fit-de-hosmer-lemeshow-et-de-pearson"><i class="fa fa-check"></i><b>7.11</b> Test de ‘fit’ de Hosmer-Lemeshow et de Pearson</a></li>
<li class="chapter" data-level="7.12" data-path="régression-logistique.html"><a href="régression-logistique.html#évaluation-des-profils-extrêmes-etou-influents"><i class="fa fa-check"></i><b>7.12</b> Évaluation des profils extrêmes et/ou influents</a></li>
<li class="chapter" data-level="7.13" data-path="régression-logistique.html"><a href="régression-logistique.html#sensibilité-spécificité-et-courbe-roc"><i class="fa fa-check"></i><b>7.13</b> Sensibilité, spécificité et courbe ROC</a></li>
<li class="chapter" data-level="7.14" data-path="régression-logistique.html"><a href="régression-logistique.html#travaux-pratiques-4---régression-logistique---base"><i class="fa fa-check"></i><b>7.14</b> Travaux pratiques 4 - Régression logistique - Base</a>
<ul>
<li class="chapter" data-level="7.14.1" data-path="régression-logistique.html"><a href="régression-logistique.html#exercices-3"><i class="fa fa-check"></i><b>7.14.1</b> Exercices</a></li>
<li class="chapter" data-level="7.14.2" data-path="régression-logistique.html"><a href="régression-logistique.html#code-r-et-réponses-3"><i class="fa fa-check"></i><b>7.14.2</b> Code R et réponses</a></li>
</ul></li>
<li class="chapter" data-level="7.15" data-path="régression-logistique.html"><a href="régression-logistique.html#travaux-pratiques-5---régression-logistique---évaluation-du-modèle"><i class="fa fa-check"></i><b>7.15</b> Travaux pratiques 5 - Régression logistique - Évaluation du modèle</a>
<ul>
<li class="chapter" data-level="7.15.1" data-path="régression-logistique.html"><a href="régression-logistique.html#exercices-4"><i class="fa fa-check"></i><b>7.15.1</b> Exercices</a></li>
<li class="chapter" data-level="7.15.2" data-path="régression-logistique.html"><a href="régression-logistique.html#code-r-et-réponses-4"><i class="fa fa-check"></i><b>7.15.2</b> Code R et réponses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html"><i class="fa fa-check"></i><b>8</b> Régression pour données de compte et d’incidence</a>
<ul>
<li class="chapter" data-level="8.1" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#régression-de-poisson"><i class="fa fa-check"></i><b>8.1</b> Régression de Poisson</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#indiquer-un-offset-i.e.-un-dénominateur-par-exemple-un-nombre-danimal-temps-à-risque"><i class="fa fa-check"></i><b>8.1.1</b> Indiquer un “offset” (i.e., un dénominateur, par exemple un nombre d’animal-temps à risque)</a></li>
<li class="chapter" data-level="8.1.2" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#test-de-rapport-de-vraisemblance"><i class="fa fa-check"></i><b>8.1.2</b> Test de rapport de vraisemblance</a></li>
<li class="chapter" data-level="8.1.3" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#présenter-les-ratios-dincidence"><i class="fa fa-check"></i><b>8.1.3</b> Présenter les ratios d’incidence</a></li>
<li class="chapter" data-level="8.1.4" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#calculer-un-compte-prédit-dévènements"><i class="fa fa-check"></i><b>8.1.4</b> Calculer un compte prédit d’évènements</a></li>
<li class="chapter" data-level="8.1.5" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#comparer-les-niveaux-dun-prédicteur-catégorique-avec-2-catégories-1"><i class="fa fa-check"></i><b>8.1.5</b> Comparer les niveaux d’un prédicteur catégorique avec &gt; 2 catégories</a></li>
<li class="chapter" data-level="8.1.6" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#linéarité-de-la-relation-pour-prédicteur-continu"><i class="fa fa-check"></i><b>8.1.6</b> Linéarité de la relation (pour prédicteur continu)</a></li>
<li class="chapter" data-level="8.1.7" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#test-de-chi-carré-de-pearson"><i class="fa fa-check"></i><b>8.1.7</b> Test de chi-carré de Pearson</a></li>
<li class="chapter" data-level="8.1.8" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#profils-extrêmes-ou-influents"><i class="fa fa-check"></i><b>8.1.8</b> Profils extrêmes ou influents</a></li>
<li class="chapter" data-level="8.1.9" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#comparer-les-comptes-observés-et-prédits"><i class="fa fa-check"></i><b>8.1.9</b> Comparer les comptes observés et prédits</a></li>
<li class="chapter" data-level="8.1.10" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#erreurs-type-mises-à-léchelle-scaled-se"><i class="fa fa-check"></i><b>8.1.10</b> Erreurs-type mises à l’échelle (scaled SE)</a></li>
<li class="chapter" data-level="8.1.11" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#variance-robuste"><i class="fa fa-check"></i><b>8.1.11</b> Variance robuste</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#régression-binomiale-négative"><i class="fa fa-check"></i><b>8.2</b> Régression binomiale négative</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#comparer-les-modèles-poisson-et-binomial-négatif"><i class="fa fa-check"></i><b>8.2.1</b> Comparer les modèles Poisson et Binomial négatif</a></li>
<li class="chapter" data-level="8.2.2" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#évaluer-les-résiduels-dun-modèle-binomial-négatif"><i class="fa fa-check"></i><b>8.2.2</b> Évaluer les résiduels d’un modèle Binomial négatif</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#modèles-zéro-enflés"><i class="fa fa-check"></i><b>8.3</b> Modèles zéro-enflés</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#généralités-2"><i class="fa fa-check"></i><b>8.3.1</b> Généralités</a></li>
<li class="chapter" data-level="8.3.2" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#test-de-vuong-comparer-modèle-zéros-enflés-au-modèle-conventionnel"><i class="fa fa-check"></i><b>8.3.2</b> Test de Vuong – Comparer modèle zéros-enflés au modèle conventionnel</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#calcul-du-risque-relatif-à-laide-dune-régression-de-poisson"><i class="fa fa-check"></i><b>8.4</b> Calcul du risque relatif à l’aide d’une régression de Poisson</a></li>
<li class="chapter" data-level="8.5" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#travaux-pratiques-6---régression-de-poisson-et-binomiale-négative"><i class="fa fa-check"></i><b>8.5</b> Travaux pratiques 6 - Régression de Poisson et Binomiale négative</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#exercices-5"><i class="fa fa-check"></i><b>8.5.1</b> Exercices</a></li>
<li class="chapter" data-level="8.5.2" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#code-r-et-réponses-5"><i class="fa fa-check"></i><b>8.5.2</b> Code R et réponses</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#travaux-pratiques-7---modèles-modifiés-en-zéro-et-calcul-dun-risque-relatif"><i class="fa fa-check"></i><b>8.6</b> Travaux pratiques 7 - Modèles modifiés en zéro et calcul d’un risque relatif</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#exercices-6"><i class="fa fa-check"></i><b>8.6.1</b> Exercices</a></li>
<li class="chapter" data-level="8.6.2" data-path="régression-pour-données-de-compte-et-dincidence.html"><a href="régression-pour-données-de-compte-et-dincidence.html#code-r-et-réponses-6"><i class="fa fa-check"></i><b>8.6.2</b> Code R et réponses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html"><i class="fa fa-check"></i><b>9</b> Analyses de survie</a>
<ul>
<li class="chapter" data-level="9.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#généralités-3"><i class="fa fa-check"></i><b>9.1</b> Généralités</a></li>
<li class="chapter" data-level="9.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#format-des-données-pour-une-analyse-de-survie"><i class="fa fa-check"></i><b>9.2</b> Format des données pour une analyse de survie</a></li>
<li class="chapter" data-level="9.3" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#analyses-non-paramétriques-kaplan-meier"><i class="fa fa-check"></i><b>9.3</b> Analyses non-paramétriques (Kaplan-Meier)</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#table-de-kaplan-meier-et-temps-médian-de-survie"><i class="fa fa-check"></i><b>9.3.1</b> Table de Kaplan-Meier et temps médian de survie</a></li>
<li class="chapter" data-level="9.3.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#courbe-de-survie-de-kaplan-meier"><i class="fa fa-check"></i><b>9.3.2</b> Courbe de survie de Kaplan-Meier</a></li>
<li class="chapter" data-level="9.3.3" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#estimer-la-probabilité-de-survie-pour-un-temps-donné"><i class="fa fa-check"></i><b>9.3.3</b> Estimer la probabilité de survie pour un temps donné</a></li>
<li class="chapter" data-level="9.3.4" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#comparaisons-entre-niveaux-dun-prédicteur-catégorique"><i class="fa fa-check"></i><b>9.3.4</b> Comparaisons entre niveaux d’un prédicteur catégorique</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#régression-de-cox-à-hasard-proportionnel"><i class="fa fa-check"></i><b>9.4</b> Régression de Cox à hasard proportionnel</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#analyses-stratifiées"><i class="fa fa-check"></i><b>9.4.1</b> Analyses stratifiées</a></li>
<li class="chapter" data-level="9.4.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#prédicteur-dont-la-valeur-change-dans-le-temps"><i class="fa fa-check"></i><b>9.4.2</b> Prédicteur dont la valeur change dans le temps</a></li>
<li class="chapter" data-level="9.4.3" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#prédicteur-dont-leffet-change-dans-le-temps"><i class="fa fa-check"></i><b>9.4.3</b> Prédicteur dont l’effet change dans le temps</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#évaluation-du-modèle-1"><i class="fa fa-check"></i><b>9.5</b> Évaluation du modèle</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#linéarité-de-la-relation-pour-les-prédicteurs-quantitatifs"><i class="fa fa-check"></i><b>9.5.1</b> Linéarité de la relation (pour les prédicteurs quantitatifs)</a></li>
<li class="chapter" data-level="9.5.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#valider-la-supposition-de-hasard-proportionnel"><i class="fa fa-check"></i><b>9.5.2</b> Valider la supposition de hasard proportionnel</a></li>
<li class="chapter" data-level="9.5.3" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#évaluer-impact-du-non-respect-de-la-supposition-de-censure-non-informative"><i class="fa fa-check"></i><b>9.5.3</b> Évaluer impact du non-respect de la supposition de censure non-informative</a></li>
<li class="chapter" data-level="9.5.4" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#observations-extrêmes"><i class="fa fa-check"></i><b>9.5.4</b> Observations extrêmes</a></li>
<li class="chapter" data-level="9.5.5" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#observations-influentes"><i class="fa fa-check"></i><b>9.5.5</b> Observations influentes</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#pour-aller-plus-loin"><i class="fa fa-check"></i><b>9.6</b> Pour aller plus loin</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#erreurs-types-robustes"><i class="fa fa-check"></i><b>9.6.1</b> Erreurs-types robustes</a></li>
<li class="chapter" data-level="9.6.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#régression-de-cox-à-fragilité-partagée"><i class="fa fa-check"></i><b>9.6.2</b> Régression de Cox à fragilité partagée</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#travaux-pratiques-8---analyses-de-survie-non-paramétriques"><i class="fa fa-check"></i><b>9.7</b> Travaux pratiques 8 - Analyses de survie non-paramétriques</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#exercices-7"><i class="fa fa-check"></i><b>9.7.1</b> Exercices</a></li>
<li class="chapter" data-level="9.7.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#code-r-et-réponses-7"><i class="fa fa-check"></i><b>9.7.2</b> Code R et réponses</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#travaux-pratiques-9---analyses-de-survie-semi-paramétriques"><i class="fa fa-check"></i><b>9.8</b> Travaux pratiques 9 - Analyses de survie semi-paramétriques</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#exercices-8"><i class="fa fa-check"></i><b>9.8.1</b> Exercices</a></li>
<li class="chapter" data-level="9.8.2" data-path="analyses-de-survie.html"><a href="analyses-de-survie.html#code-r-et-réponses-8"><i class="fa fa-check"></i><b>9.8.2</b> Code R et réponses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html"><i class="fa fa-check"></i><b>10</b> Modèles mixtes pour données structurées</a>
<ul>
<li class="chapter" data-level="10.1" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#généralités-4"><i class="fa fa-check"></i><b>10.1</b> Généralités</a></li>
<li class="chapter" data-level="10.2" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#évaluer-la-structure-de-regroupement"><i class="fa fa-check"></i><b>10.2</b> Évaluer la structure de regroupement</a></li>
<li class="chapter" data-level="10.3" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#modèle-linéaire-mixte"><i class="fa fa-check"></i><b>10.3</b> Modèle linéaire mixte</a></li>
<li class="chapter" data-level="10.4" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#modèle-mixte-avec-un-seul-intercept-aléatoire"><i class="fa fa-check"></i><b>10.4</b> Modèle mixte avec un seul intercept aléatoire</a></li>
<li class="chapter" data-level="10.5" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#modèle-mixte-avec-plus-dun-intercept-aléatoire"><i class="fa fa-check"></i><b>10.5</b> Modèle mixte avec plus d’un intercept aléatoire</a></li>
<li class="chapter" data-level="10.6" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#partition-de-la-variance"><i class="fa fa-check"></i><b>10.6</b> Partition de la variance</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#coefficient-de-corrélation-intra-classe"><i class="fa fa-check"></i><b>10.6.1</b> Coefficient de corrélation intra-classe</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#effet-contextuel"><i class="fa fa-check"></i><b>10.7</b> Effet contextuel</a></li>
<li class="chapter" data-level="10.8" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#évaluation-du-modèle-2"><i class="fa fa-check"></i><b>10.8</b> Évaluation du modèle</a></li>
<li class="chapter" data-level="10.9" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#pentes-aléatoires"><i class="fa fa-check"></i><b>10.9</b> Pentes aléatoires</a></li>
<li class="chapter" data-level="10.10" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#travaux-pratiques-10---modèles-linéaires-mixtes"><i class="fa fa-check"></i><b>10.10</b> Travaux pratiques 10 - Modèles linéaires mixtes</a>
<ul>
<li class="chapter" data-level="10.10.1" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#exercices-9"><i class="fa fa-check"></i><b>10.10.1</b> Exercices</a></li>
<li class="chapter" data-level="10.10.2" data-path="modèles-mixtes-pour-données-structurées.html"><a href="modèles-mixtes-pour-données-structurées.html#code-r-et-réponses-9"><i class="fa fa-check"></i><b>10.10.2</b> Code R et réponses</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publié avec bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Épidémiologie 2 - Labo informatique R (PTM-6675)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyses-de-survie" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapitre 9</span> Analyses de survie<a href="analyses-de-survie.html#analyses-de-survie" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="généralités-3" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Généralités<a href="analyses-de-survie.html#généralités-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>L’analyse de survie est une collection de procédures statistiques pour l’analyse de données où la variable dépendante est le temps jusqu’à ce qu’un certain événement survienne. Cet événement peut être un décès, un événement de santé, une rechute après une rémission, une guérison ou toute autre expérience vécue par le sujet. Le temps peut être des années, mois, semaines ou jours depuis le début du suivi jusqu’à ce que l’événement survienne. Ce temps peut référer à l’âge du sujet au moment de l’événement, à un moment de son cycle de production (e.g. jours en lait), etc. On considère en général que l’événement ne se produit qu’une seule fois. Une caractéristique de ces données est que souvent plusieurs observations sont « censurées » (i.e. plusieurs individus n’expérimentent pas l’événement et on ne peut donc avoir un temps précis jusqu’à l’événement pour ces individus). La variable dépendante est le temps de survie sans l’événement. L’événement est l’échec (failure) parce que c’est souvent un événement « négatif ». Mais il peut aussi être positif, comme le temps pour le retour à la compétition après une chirurgie pour un cheval de course.</p>
<p>La librairie <code>survival</code> vous permettra de réaliser la plupart de vos analyses de survie. La librairie <code>survminer</code> facilitera la présentation des figures typiquement utilisées en analyse de survie.</p>
<p>Certains cas particuliers qui ne seront pas vus dans le cadre du cours demanderont des analyses de survie particulières :<br />
1) si plus d’un événement est considéré (e.g. une maladie qui se produit plus d’une fois, comme des cas de mammites), on considère alors que c’est un événement récurrent;<br />
2) si le décès peut être le résultat de différentes causes, on peut considérer que c’est un risque compétitif (i.e. les maladies compétitionnent entre elles pour causer le décès).</p>
<p>Le jeu de donnée <em>calf_pneu.csv</em> sera utilisé pour les analyses non-paramétriques.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="analyses-de-survie.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Importons ce jeu de données</span></span>
<span id="cb344-2"><a href="analyses-de-survie.html#cb344-2" aria-hidden="true" tabindex="-1"></a>calf <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">&quot;calf_pneu.csv&quot;</span>, </span>
<span id="cb344-3"><a href="analyses-de-survie.html#cb344-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb344-4"><a href="analyses-de-survie.html#cb344-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb344-5"><a href="analyses-de-survie.html#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(calf)</span></code></pre></div>
<pre><code>##   calf stock days pn
## 1    1     1   27  1
## 2    2     1   49  1
## 3    3     1   72  1
## 4    4     1   79  1
## 5    5     1   90  1
## 6    6     1  113  1</code></pre>
</div>
<div id="format-des-données-pour-une-analyse-de-survie" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Format des données pour une analyse de survie<a href="analyses-de-survie.html#format-des-données-pour-une-analyse-de-survie" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La table plus haut illustre la disposition des données pour leur analyse, telle que requise par votre logiciel statistique. Une variable (<em>calf</em> dans ce cas) doit identifier chaque sujet, une autre (<em>days</em>) donne le temps de survie (votre variable dépendante), une autre indique le statut de l’individu à la fin du suivi (<em>pn</em>; en général 0 si censure, 1 si l’événement s’est produit). Les autres variables (une seule, <em>stock</em>, dans ce cas) seront les variables prédictives.</p>
<p>Par convention, les noms de variables <em>dur</em> et <em>statut</em> sont souvent utilisés pour définir le temps de survie et le statut de l’individu à la fin du suivi, respectivement.</p>
</div>
<div id="analyses-non-paramétriques-kaplan-meier" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Analyses non-paramétriques (Kaplan-Meier)<a href="analyses-de-survie.html#analyses-non-paramétriques-kaplan-meier" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="table-de-kaplan-meier-et-temps-médian-de-survie" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Table de Kaplan-Meier et temps médian de survie<a href="analyses-de-survie.html#table-de-kaplan-meier-et-temps-médian-de-survie" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La fonction <code>Surv()</code> de la librairie <code>survival</code> permet d’indiquer les temps de survie et les statuts. C’est cette combinaison qui sera utilisée comme variable réponse dans les étapes subséquentes. Le premier argument indiqué est la variable décrivant le temps de survie (<em>days</em>), le deuxième argument est la variable décrivant le statut (<em>pn</em>).</p>
<p>La table de survie de Kaplan-Meier peut ensuite être produite à l’aide de la fonction <code>survfit()</code>. Le premier argument indique la fonction qui servira à générer les tables et courbes de survie. Si aucun prédicteur n’est indiqué (i.e., <code>~ 1</code>), on demande alors une seule table et une seule courbe de survie. En ajoutant un prédicteur après le <code>~</code>, on aura alors une table et une courbe par niveau du prédicteur.</p>
<ul>
<li>Vous pourrez directement utiliser la fonction <code>survfit()</code> dans ce cas, le temps médian de survie et son <em>IC95</em> vous sera rapporté.<br />
</li>
<li>Vous pouvez aussi créer un nouvel objet (par exemple <code>km_fit &lt;- survfit()</code>) et utiliser la fonction <code>summary()</code> sur cet objet. Dans ce cas, la table de survie de Kaplan-Meier sera présentée.</li>
</ul>
<p>Le code suivant, par exemple, permet de présenter le temps médian de survie, puis de générer un nouvel objet que j’ai nommé <em>km_fit</em> et qui est, en fait, la table de Kaplan-Meier décrivant le temps jusqu’à une pneumonie pour 24 veaux.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="analyses-de-survie.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb346-2"><a href="analyses-de-survie.html#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="at">data=</span>calf,</span>
<span id="cb346-3"><a href="analyses-de-survie.html#cb346-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb346-4"><a href="analyses-de-survie.html#cb346-4" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(days, pn) ~ 1, data = calf)
## 
##       n events median 0.95LCL 0.95UCL
## [1,] 24     12    123     113      NA</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="analyses-de-survie.html#cb348-1" aria-hidden="true" tabindex="-1"></a>km_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>calf, </span>
<span id="cb348-2"><a href="analyses-de-survie.html#cb348-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb348-3"><a href="analyses-de-survie.html#cb348-3" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb348-4"><a href="analyses-de-survie.html#cb348-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(km_fit)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(days, pn) ~ 1, data = calf)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##    27     24       1    0.958  0.0408        0.882        1.000
##    49     23       1    0.917  0.0564        0.813        1.000
##    72     22       1    0.875  0.0675        0.752        1.000
##    79     21       2    0.792  0.0829        0.645        0.972
##    89     19       1    0.750  0.0884        0.595        0.945
##    90     18       1    0.708  0.0928        0.548        0.916
##   101     17       1    0.667  0.0962        0.502        0.885
##   113     15       2    0.578  0.1019        0.409        0.816
##   117      9       1    0.514  0.1089        0.339        0.778
##   123      6       1    0.428  0.1198        0.247        0.741</code></pre>
</div>
<div id="courbe-de-survie-de-kaplan-meier" class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Courbe de survie de Kaplan-Meier<a href="analyses-de-survie.html#courbe-de-survie-de-kaplan-meier" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La courbe de survie de Kaplan-Meier pourra être générée en appliquant la fonction <code>ggsurvplot()</code> de la librairie <code>survminer</code> à ce nouvel objet <em>km_fit</em>. La librairie <code>survminer</code> et sa fonction <code>ggsurvplot()</code> sont très flexibles pour produire les figures en lien avec les analyses de survie.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="analyses-de-survie.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb350-2"><a href="analyses-de-survie.html#cb350-2" aria-hidden="true" tabindex="-1"></a>survie <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit, </span>
<span id="cb350-3"><a href="analyses-de-survie.html#cb350-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.int =</span> <span class="cn">TRUE</span></span>
<span id="cb350-4"><a href="analyses-de-survie.html#cb350-4" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb350-5"><a href="analyses-de-survie.html#cb350-5" aria-hidden="true" tabindex="-1"></a>survie</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>Et ce sera ensuite facile de modifier cette figure avec toutes les fonctions de <code>ggplot</code> auxquelles vous êtes habitué. Par exemple:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="analyses-de-survie.html#cb351-1" aria-hidden="true" tabindex="-1"></a>survie<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb351-2"><a href="analyses-de-survie.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
<p>En continuant avec <code>survminer</code>, je pourrais demander la fonction d’échec (i.e., le contraire de la fonction de survie) à l’aide de l’argument <code>fun="event"</code>.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="analyses-de-survie.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb352-2"><a href="analyses-de-survie.html#cb352-2" aria-hidden="true" tabindex="-1"></a>echec <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit, </span>
<span id="cb352-3"><a href="analyses-de-survie.html#cb352-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb352-4"><a href="analyses-de-survie.html#cb352-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fun=</span><span class="st">&quot;event&quot;</span></span>
<span id="cb352-5"><a href="analyses-de-survie.html#cb352-5" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb352-6"><a href="analyses-de-survie.html#cb352-6" aria-hidden="true" tabindex="-1"></a>echec</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<p>Ou encore la fonction de hasard cumulatif (i.e., cumulative hazard function) à l’aide de la fonction <code>fun="cumhaz"</code>.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="analyses-de-survie.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb353-2"><a href="analyses-de-survie.html#cb353-2" aria-hidden="true" tabindex="-1"></a>cum <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit, </span>
<span id="cb353-3"><a href="analyses-de-survie.html#cb353-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb353-4"><a href="analyses-de-survie.html#cb353-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fun=</span><span class="st">&quot;cumhaz&quot;</span></span>
<span id="cb353-5"><a href="analyses-de-survie.html#cb353-5" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb353-6"><a href="analyses-de-survie.html#cb353-6" aria-hidden="true" tabindex="-1"></a>cum</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
</div>
<div id="estimer-la-probabilité-de-survie-pour-un-temps-donné" class="section level3 hasAnchor" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Estimer la probabilité de survie pour un temps donné<a href="analyses-de-survie.html#estimer-la-probabilité-de-survie-pour-un-temps-donné" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>L’argument <code>times=</code> de la fonction <code>survfit()</code> permet d’estimer la proportion (et son <em>IC95</em>) des individus qui “survivront” jusqu’à un temps <em>t</em>. Par exemple, ce code me permet d’estimer que 91.7% (<em>IC95</em>= 81.3, 100) des veaux n’avaient pas eu de pneumonie après 50 jours.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="analyses-de-survie.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb354-2"><a href="analyses-de-survie.html#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">survfit</span>(<span class="at">data=</span>calf,</span>
<span id="cb354-3"><a href="analyses-de-survie.html#cb354-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb354-4"><a href="analyses-de-survie.html#cb354-4" aria-hidden="true" tabindex="-1"></a>                ), </span>
<span id="cb354-5"><a href="analyses-de-survie.html#cb354-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">times =</span> <span class="dv">50</span></span>
<span id="cb354-6"><a href="analyses-de-survie.html#cb354-6" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(days, pn) ~ 1, data = calf)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##    50     22       2    0.917  0.0564        0.813            1</code></pre>
</div>
<div id="comparaisons-entre-niveaux-dun-prédicteur-catégorique" class="section level3 hasAnchor" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> Comparaisons entre niveaux d’un prédicteur catégorique<a href="analyses-de-survie.html#comparaisons-entre-niveaux-dun-prédicteur-catégorique" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>L’analyse de survie non-paramétrique (i.e. Kaplan-Meier) permet de comparer les fonctions de survie des différents niveaux d’un prédicteur catégorique. Le code suivant, par exemple, permet de vérifier l’effet du type d’élevage (variable <em>stock</em>; en batch <em>vs.</em> en continu) sur le temps jusqu’à la pneumonie. Vous aurez maintenant un temps médian de survie par niveau d’exposition (notez que celui-ci ne peut pas toujours être calculé, dépendamment du nombre d’observations).</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="analyses-de-survie.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb356-2"><a href="analyses-de-survie.html#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="at">data=</span>calf,</span>
<span id="cb356-3"><a href="analyses-de-survie.html#cb356-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> stock</span>
<span id="cb356-4"><a href="analyses-de-survie.html#cb356-4" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(days, pn) ~ stock, data = calf)
## 
##          n events median 0.95LCL 0.95UCL
## stock=0 12      4     NA     123      NA
## stock=1 12      8    113      79      NA</code></pre>
<p>Vous aurez également une table de Kaplan-Meier par niveau d’exposition.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="analyses-de-survie.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb358-2"><a href="analyses-de-survie.html#cb358-2" aria-hidden="true" tabindex="-1"></a>km_fit_stock <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>calf,</span>
<span id="cb358-3"><a href="analyses-de-survie.html#cb358-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> stock</span>
<span id="cb358-4"><a href="analyses-de-survie.html#cb358-4" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb358-5"><a href="analyses-de-survie.html#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(km_fit_stock)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(days, pn) ~ stock, data = calf)
## 
##                 stock=0 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##    79     12       1    0.917  0.0798        0.773            1
##    89     11       1    0.833  0.1076        0.647            1
##   101     10       1    0.750  0.1250        0.541            1
##   123      5       1    0.600  0.1673        0.347            1
## 
##                 stock=1 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##    27     12       1    0.917  0.0798        0.773        1.000
##    49     11       1    0.833  0.1076        0.647        1.000
##    72     10       1    0.750  0.1250        0.541        1.000
##    79      9       1    0.667  0.1361        0.447        0.995
##    90      8       1    0.583  0.1423        0.362        0.941
##   113      7       2    0.417  0.1423        0.213        0.814
##   117      4       1    0.312  0.1398        0.130        0.751</code></pre>
<p>Finalement, vous aurez aussi une courbe de survie par niveau d’exposition.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="analyses-de-survie.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb360-2"><a href="analyses-de-survie.html#cb360-2" aria-hidden="true" tabindex="-1"></a>survie <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit_stock, </span>
<span id="cb360-3"><a href="analyses-de-survie.html#cb360-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.int =</span> <span class="cn">TRUE</span></span>
<span id="cb360-4"><a href="analyses-de-survie.html#cb360-4" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb360-5"><a href="analyses-de-survie.html#cb360-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-6"><a href="analyses-de-survie.html#cb360-6" aria-hidden="true" tabindex="-1"></a>survie<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb360-7"><a href="analyses-de-survie.html#cb360-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb360-8"><a href="analyses-de-survie.html#cb360-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Nombre de jours&quot;</span>) <span class="sc">+</span></span>
<span id="cb360-9"><a href="analyses-de-survie.html#cb360-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Probabilité de survie&quot;</span>)<span class="sc">+</span> </span>
<span id="cb360-10"><a href="analyses-de-survie.html#cb360-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Type d&#39;élevage&quot;</span>, </span>
<span id="cb360-11"><a href="analyses-de-survie.html#cb360-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;En batch&quot;</span>, </span>
<span id="cb360-12"><a href="analyses-de-survie.html#cb360-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;En continu&quot;</span></span>
<span id="cb360-13"><a href="analyses-de-survie.html#cb360-13" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb360-14"><a href="analyses-de-survie.html#cb360-14" aria-hidden="true" tabindex="-1"></a>                      ) <span class="sc">+</span></span>
<span id="cb360-15"><a href="analyses-de-survie.html#cb360-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Type d&#39;élevage&quot;</span>, </span>
<span id="cb360-16"><a href="analyses-de-survie.html#cb360-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;En batch&quot;</span>,</span>
<span id="cb360-17"><a href="analyses-de-survie.html#cb360-17" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;En continu&quot;</span></span>
<span id="cb360-18"><a href="analyses-de-survie.html#cb360-18" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb360-19"><a href="analyses-de-survie.html#cb360-19" aria-hidden="true" tabindex="-1"></a>                       )</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-105-1.png" width="672" /></p>
<p>Finalement, vous pourrez tester les différences entre les niveaux d’exposition à l’aide des tests de log-rank et/ou de Wilcoxon à l’aide de la fonction <code>survdiff()</code>. Le premier argument est notre modèle, le deuxième est le jeu de données, l’argument <code>rho=0</code> permettra d’indiquer que le test de log-rank est désiré. En utilisant <code>rho=1</code>, ce sera plutôt le test de Wilcoxon qui sera réalisé.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="analyses-de-survie.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb361-2"><a href="analyses-de-survie.html#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="co">#log-rank</span></span>
<span id="cb361-3"><a href="analyses-de-survie.html#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>calf,</span>
<span id="cb361-4"><a href="analyses-de-survie.html#cb361-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> stock,  </span>
<span id="cb361-5"><a href="analyses-de-survie.html#cb361-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">0</span></span>
<span id="cb361-6"><a href="analyses-de-survie.html#cb361-6" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(days, pn) ~ stock, data = calf, rho = 0)
## 
##          N Observed Expected (O-E)^2/E (O-E)^2/V
## stock=0 12        4     6.89      1.21      2.99
## stock=1 12        8     5.11      1.63      2.99
## 
##  Chisq= 3  on 1 degrees of freedom, p= 0.08</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="analyses-de-survie.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Wilcoxon</span></span>
<span id="cb363-2"><a href="analyses-de-survie.html#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>calf,</span>
<span id="cb363-3"><a href="analyses-de-survie.html#cb363-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(days, pn) <span class="sc">~</span> stock,  </span>
<span id="cb363-4"><a href="analyses-de-survie.html#cb363-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(days, pn) ~ stock, data = calf, rho = 1)
## 
##          N Observed Expected (O-E)^2/E (O-E)^2/V
## stock=0 12     2.89     5.25      1.06      3.13
## stock=1 12     6.41     4.05      1.38      3.13
## 
##  Chisq= 3.1  on 1 degrees of freedom, p= 0.08</code></pre>
<p>Dans ce cas, les deux tests donnent une valeur de <em>P</em> de 0.08. C’est donc dire que les courbes de survie des veaux élevés en batch ou en continu ne sont pas différentes.</p>
<p>Notez que plus d’une variable peut être utilisée pour stratifier les données. Par exemple, le jeu de données <em>pgtrial.csv</em> contient plusieurs prédicteurs. Cette étude est un essai clinique randomisé sur l’effet de l’administration d’une dose de prostaglandine <em>vs.</em> d’un placebo (la variable <em>tx</em>) au début de la période de reproduction sur le nombre de jours (la variable <em>dar</em>) jusqu’à la conception (la variable <em>preg</em>). L’hypothèse était que l’administration de prostaglandine réduirait le nombre de jours jusqu’à la conception. Les 319 vaches de cette étude étaient suivies jusqu’à un maximum de 346 jours en lait. Trois autres prédicteurs étaient aussi évalués: le nombre de lactations (<em>lact</em>; 1, 2, 3…), l’état de chair (<em>thin</em>; 0=normal, 1=thin) et le troupeau (<em>herd</em>; 3 troupeaux).</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="analyses-de-survie.html#cb365-1" aria-hidden="true" tabindex="-1"></a>pgtrial <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">&quot;pgtrial.csv&quot;</span>, </span>
<span id="cb365-2"><a href="analyses-de-survie.html#cb365-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb365-3"><a href="analyses-de-survie.html#cb365-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb365-4"><a href="analyses-de-survie.html#cb365-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pgtrial)</span></code></pre></div>
<pre><code>##   herd cow tx lact thin dar preg
## 1    1   1  0    1    0   1    1
## 2    1   2  1    4    1   1    1
## 3    1   3  1    1    0   2    1
## 4    1   4  1    1    0   3    1
## 5    1   5  1    6    0   3    0
## 6    1   6  1    1    0   3    1</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="analyses-de-survie.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nous indiquons les variables catégoriques dans le jeu de données</span></span>
<span id="cb367-2"><a href="analyses-de-survie.html#cb367-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>thin <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>thin) </span>
<span id="cb367-3"><a href="analyses-de-survie.html#cb367-3" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>herd <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>herd) </span></code></pre></div>
<p>Le code suivant pourra être utilisé pour effectuer une analyse de survie non-paramétrique par groupe de traitement (<em>tx</em>) <strong>ET</strong> par état de chair (<em>thin</em>). Dans ce cas, vous auriez quatre strates de <em>tx</em> par <em>thin</em> possibles (0-0, 0-1, 1-0, et 1-1). La fonction <code>survfit()</code> vous rapportera alors toutes les comparaisons entre chaque paire de strates (4 comparaisons dans ce cas).</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="analyses-de-survie.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb368-2"><a href="analyses-de-survie.html#cb368-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-3"><a href="analyses-de-survie.html#cb368-3" aria-hidden="true" tabindex="-1"></a>km_fit_pg <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb368-4"><a href="analyses-de-survie.html#cb368-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> thin</span>
<span id="cb368-5"><a href="analyses-de-survie.html#cb368-5" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb368-6"><a href="analyses-de-survie.html#cb368-6" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb368-7"><a href="analyses-de-survie.html#cb368-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> thin,  </span>
<span id="cb368-8"><a href="analyses-de-survie.html#cb368-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">0</span></span>
<span id="cb368-9"><a href="analyses-de-survie.html#cb368-9" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(dar, preg) ~ tx + thin, data = pgtrial, 
##     rho = 0)
## 
##               N Observed Expected (O-E)^2/E (O-E)^2/V
## tx=0, thin=0 73       63     60.8    0.0806     0.107
## tx=0, thin=1 95       76     88.3    1.7023     2.634
## tx=1, thin=0 73       60     53.8    0.7213     0.928
## tx=1, thin=1 78       65     61.2    0.2380     0.317
## 
##  Chisq= 2.8  on 3 degrees of freedom, p= 0.4</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="analyses-de-survie.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb370-2"><a href="analyses-de-survie.html#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(km_fit_pg, </span>
<span id="cb370-3"><a href="analyses-de-survie.html#cb370-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">conf.int =</span> <span class="cn">TRUE</span></span>
<span id="cb370-4"><a href="analyses-de-survie.html#cb370-4" aria-hidden="true" tabindex="-1"></a>           )</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p>C’est beaucoup d’information sur une même figure! Vous pourriez aussi la séparer à l’aide de la fonction <code>facet_grid()</code> de la librairie <code>ggplot2</code> afin de pouvoir comparer plus aisément l’effet du traitement chez les vaches maigres, puis chez les vaches normales.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="analyses-de-survie.html#cb371-1" aria-hidden="true" tabindex="-1"></a>ggsurv <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit_pg, </span>
<span id="cb371-2"><a href="analyses-de-survie.html#cb371-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.int =</span> <span class="cn">TRUE</span></span>
<span id="cb371-3"><a href="analyses-de-survie.html#cb371-3" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb371-4"><a href="analyses-de-survie.html#cb371-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb371-5"><a href="analyses-de-survie.html#cb371-5" aria-hidden="true" tabindex="-1"></a>ggsurv<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb371-6"><a href="analyses-de-survie.html#cb371-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb371-7"><a href="analyses-de-survie.html#cb371-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span> (<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb371-8"><a href="analyses-de-survie.html#cb371-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> thin)</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
</div>
</div>
<div id="régression-de-cox-à-hasard-proportionnel" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Régression de Cox à hasard proportionnel<a href="analyses-de-survie.html#régression-de-cox-à-hasard-proportionnel" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Si on veut comparer la survie de deux groupes en ajustant pour les effets confondants ou des modificateurs d’effet potentiels, on peut utiliser un modèle de risques proportionnels (proportional hazards model) ou modèle de régression de Cox. La fonction <code>coxph()</code> (pour Cox <strong>P</strong>roportional <strong>H</strong>azard) de la librairie <code>survival</code> permet de réaliser les régressions de Cox.</p>
<p>Par exemple, le code suivant permet d’estimer un modèle de Cox à hasard proportionnel qui décrit l’effet d’un traitement à la prostaglandine (<em>tx</em>) sur le temps jusqu’à la conception (<em>dar</em> et <em>preg</em>) après ajustement pour les biais de confusion par la parité (<em>lact</em>), l’état de chair (<em>thin</em>) et le troupeau d’origine (<em>herd</em>).</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="analyses-de-survie.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb372-2"><a href="analyses-de-survie.html#cb372-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb372-3"><a href="analyses-de-survie.html#cb372-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb372-4"><a href="analyses-de-survie.html#cb372-4" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb372-5"><a href="analyses-de-survie.html#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx + lact + thin + herd, data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##           coef exp(coef) se(coef)      z Pr(&gt;|z|)  
## tx     0.19603   1.21657  0.12543  1.563    0.118  
## lact  -0.04360   0.95733  0.04118 -1.059    0.290  
## thin1 -0.14713   0.86318  0.13804 -1.066    0.286  
## herd2 -0.28544   0.75169  0.16993 -1.680    0.093 .
## herd3  0.04032   1.04115  0.17453  0.231    0.817  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##       exp(coef) exp(-coef) lower .95 upper .95
## tx       1.2166     0.8220    0.9514     1.556
## lact     0.9573     1.0446    0.8831     1.038
## thin1    0.8632     1.1585    0.6586     1.131
## herd2    0.7517     1.3303    0.5388     1.049
## herd3    1.0411     0.9605    0.7395     1.466
## 
## Concordance= 0.565  (se = 0.019 )
## Likelihood ratio test= 9.94  on 5 df,   p=0.08
## Wald test            = 9.76  on 5 df,   p=0.08
## Score (logrank) test = 9.78  on 5 df,   p=0.08</code></pre>
<p>La fonction <code>summary()</code> vous permet de rapporter le nombre d’observations (n=319) et le nombre de vaches ayant eu une conception (n=264). On vous rapporte ensuite les coefficients pour chacun des prédicteurs, leur erreur-type, leur <em>IC95</em> et la valeur de <em>P</em> du test de Wald pour ce coefficient particulier. La table suivante présente les hazard ratios (HR) et leur <em>IC95</em> (ce sont simplement les coefficients et leur <em>IC95</em> mis à l’exposant). Enfin, le test de rapport de vraisemblance qui vérifie si au moins un coefficient est différent de 0 est présenté (ici, <em>P</em>=0.08).</p>
<p>Pour générer une figure de la fonction de survie de Cox, on devra utiliser la fonction <code>ggadjustedcurves()</code> de la librairie <code>survminer</code>. L’argument <code>variable="tx"</code> me permet de générer des fonctions de survie de Cox par niveaux d’un prédicteur (ici <em>tx</em>).</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="analyses-de-survie.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co">#La courbe de survie de Cox</span></span>
<span id="cb374-2"><a href="analyses-de-survie.html#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb374-3"><a href="analyses-de-survie.html#cb374-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggadjustedcurves</span>(PH_fit_pg, </span>
<span id="cb374-4"><a href="analyses-de-survie.html#cb374-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">variable=</span><span class="st">&quot;tx&quot;</span></span>
<span id="cb374-5"><a href="analyses-de-survie.html#cb374-5" aria-hidden="true" tabindex="-1"></a>                 )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-111"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-111-1.png" alt="Fonction de survie de Cox par niveau de la variable traitement." width="672" />
<p class="caption">
Figure 9.1: Fonction de survie de Cox par niveau de la variable traitement.
</p>
</div>
<div id="analyses-stratifiées" class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Analyses stratifiées<a href="analyses-de-survie.html#analyses-stratifiées" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>On peut réaliser une analyse stratifiée par un prédicteur à l’aide de la fonction <code>strata()</code>. L’analyse stratifiée par un prédicteur pourra être utile:<br />
- lorsque ce prédicteur ne satisfait pas à la supposition de proportionnalité des Hazard Ratio et que le prédicteur n’est pas d’intérêt direct (e.g. un facteur confondant);<br />
- afin de prendre en compte le regroupement d’observations (la variable de stratification sera alors la variable indiquant le groupe d’appartenance; <em>herd</em> dans l’exemple suivant).</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="analyses-de-survie.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb375-2"><a href="analyses-de-survie.html#cb375-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb375-3"><a href="analyses-de-survie.html#cb375-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> <span class="fu">strata</span>(herd)</span>
<span id="cb375-4"><a href="analyses-de-survie.html#cb375-4" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb375-5"><a href="analyses-de-survie.html#cb375-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx + lact + thin + strata(herd), 
##     data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##           coef exp(coef) se(coef)      z Pr(&gt;|z|)
## tx     0.20490   1.22740  0.12622  1.623    0.105
## lact  -0.04218   0.95870  0.04101 -1.029    0.304
## thin1 -0.13871   0.87048  0.13857 -1.001    0.317
## 
##       exp(coef) exp(-coef) lower .95 upper .95
## tx       1.2274     0.8147    0.9584     1.572
## lact     0.9587     1.0431    0.8847     1.039
## thin1    0.8705     1.1488    0.6634     1.142
## 
## Concordance= 0.558  (se = 0.021 )
## Likelihood ratio test= 5.43  on 3 df,   p=0.1
## Wald test            = 5.44  on 3 df,   p=0.1
## Score (logrank) test = 5.46  on 3 df,   p=0.1</code></pre>
<p>Notez que l’effet de la variable utilisée pour stratifier n’est plus calculé maintenant.</p>
</div>
<div id="prédicteur-dont-la-valeur-change-dans-le-temps" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Prédicteur dont la valeur change dans le temps<a href="analyses-de-survie.html#prédicteur-dont-la-valeur-change-dans-le-temps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Lorsqu’un prédicteur peut changer de valeur en cours de suivi, le jeu de données doit être réorganisé avec plusieurs intervalles pour chaque sujet. Ce format s’appelle le <em>counting process format</em> (<strong>CP</strong>). Le format CP est en fait adapté à plusieurs situations d’analyse de survie complexes:<br />
- quand il y a présence de prédicteurs dont la valeur change dans le temps;<br />
- quand l’âge plutôt que le temps est utilisé comme mesure du suivi (on voudra alors indiquer l’âge de début et l’âge de fin);<br />
- quand il y a des événements récurrents et/ou que l’occurrence de l’événement ne peut être observée en continu (ex: animaux testés mensuellement pour identifier l’acquisition d’une infection).</p>
<p>Le format général des données dans le format CP est montré à la table suivante. Pour chaque individu, il y a plusieurs lignes: chaque temps de suivi est divisé en petits intervalles de temps. Il y a aussi deux variables de temps spécifiées pour chaque individu, une indiquant le début du suivi (<em>start</em> dans ce cas) et une indiquant la fin du suivi (<em>stop</em> dans ce cas). Une variable (<em>dead2</em> dans ce cas) indique ce qui s’est produit à la fin du suivi (dans cet exemple censure=0 et mort=1).</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="analyses-de-survie.html#cb377-1" aria-hidden="true" tabindex="-1"></a>stan <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">&quot;stanlong.csv&quot;</span>, </span>
<span id="cb377-2"><a href="analyses-de-survie.html#cb377-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb377-3"><a href="analyses-de-survie.html#cb377-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">sep=</span><span class="st">&quot;;&quot;</span></span>
<span id="cb377-4"><a href="analyses-de-survie.html#cb377-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb377-5"><a href="analyses-de-survie.html#cb377-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stan)</span></code></pre></div>
<pre><code>##   id dead surg ageaccpt trans plant start dead2 stop
## 1  1    1    0 30.84463     0     0   0.0     1 49.0
## 2  2    1    0 51.83573     0     0   0.0     1  5.0
## 3  3    1    0 54.29706     1     0   0.0     0  0.1
## 4  3    1    0 54.29706     1     1   0.1     1 15.0
## 5  4    1    0 40.26283     1     0   0.0     0 35.0
## 6  4    1    0 40.26283     1     1  35.0     1 38.0</code></pre>
<p>Dans l’exemple plus haut, on voit que les individus 3 et 4 ont bien 2 intervalles de temps (2 rangées) puisque le prédicteur <em>trans</em> (indiquant s’ils ont eu ou non une transplantation cardiaque) a changé de valeur (de 0 à 1) pour ces individus durant l’étude. On comprend donc que l’individu 3 a reçu une transplantation très rapidement à 0.1 jour (c’est là que son statut <em>trans</em> a changé) et il est malheureusement décédé à 15 jours. L’individu 4 a reçu une transplantation 35 jours après son accident cardio-vasculaire et il est décédé 3 jours plus tard, soit 38 jours après son accident cardio-vasculaire.</p>
<p>Pour analyser ce genre de données, vous devrez indiquer les variables indiquant le début et la fin de chaque intervalle dans votre fonction <code>surv()</code> à la place de votre variable représentant le temps (e.g. <em>dur</em>, <em>dar</em>, ou <em>days</em>). Par exemple, le modèle suivant présente le temps d’un accident cardio-vasculaire jusqu’au décès en fonction de si le patient a reçu une transplantation cardiaque (une variable qui peut changer de valeur dans le temps) et après ajustement pour l’âge du patient.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="analyses-de-survie.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb379-2"><a href="analyses-de-survie.html#cb379-2" aria-hidden="true" tabindex="-1"></a>PH_fit_stan <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>stan,</span>
<span id="cb379-3"><a href="analyses-de-survie.html#cb379-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Surv</span>(start, stop, dead2) <span class="sc">~</span> trans <span class="sc">+</span> ageaccpt</span>
<span id="cb379-4"><a href="analyses-de-survie.html#cb379-4" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb379-5"><a href="analyses-de-survie.html#cb379-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_stan)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, dead2) ~ trans + ageaccpt, 
##     data = stan)
## 
##   n= 172, number of events= 75 
## 
##              coef exp(coef) se(coef)      z        Pr(&gt;|z|)    
## trans    -1.80047   0.16522  0.27225 -6.613 0.0000000000376 ***
## ageaccpt  0.06020   1.06205  0.01531  3.933 0.0000840052418 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##          exp(coef) exp(-coef) lower .95 upper .95
## trans       0.1652     6.0525    0.0969    0.2817
## ageaccpt    1.0620     0.9416    1.0307    1.0944
## 
## Concordance= 0.721  (se = 0.035 )
## Likelihood ratio test= 44.46  on 2 df,   p=0.0000000002
## Wald test            = 46.04  on 2 df,   p=0.0000000001
## Score (logrank) test = 51.05  on 2 df,   p=0.000000000008</code></pre>
<p>Le <em>HR</em> de décès chez les patients ayant eu une transplantation cardiaque était 0.17 (<em>IC95</em>: 0.10, 0.28) fois celui de ceux qui n’en ont pas eu. Pour cette dernière catégorie, le temps passé sans transplantation par des patients qui seront transplantés dans le futur est aussi compilé.</p>
</div>
<div id="prédicteur-dont-leffet-change-dans-le-temps" class="section level3 hasAnchor" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> Prédicteur dont l’effet change dans le temps<a href="analyses-de-survie.html#prédicteur-dont-leffet-change-dans-le-temps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Avec le modèle de régression de Cox, le risque peut évoluer au cours du temps, mais il doit rester proportionnel entre sujets avec différents niveaux d’exposition. Cette supposition pourra être vérifiée (voir section évaluation du modèle). Cette supposition peut aussi être relaxée en ajoutant une interaction entre le temps et un prédicteur. Si cette interaction est significativement différente de zéro, on conclura que le risque n’était pas proportionnel et on présentera alors les résultats du modèle avec l’interaction. Pour ce faire, la variable représentant le temps pourra être transformée (e.g., une transformation log, une catégorisation en deux, ou plus de deux catégories, etc) en fonction de la biologie du phénomène étudié.</p>
<p>Par exemple, le code suivant permettrait d’évaluer une interaction avec le temps qui représenterait un changement d’effet de la prostaglandine entre les 5 premiers jours <em>vs.</em> le reste de la période de suivi. On pourrait émettre l’hypothèse que le traitement aux prostaglandines aura un effet dans les 5 jours suivants l’administration, mais aucun ou peu d’effet par la suite. <strong>Important:</strong> en ajoutant un terme d’interaction (ex: <em>tx x time5</em> dans votre fonction <code>coxph()</code>, R inclura automatiquement les deux termes principaux pour cette interaction (<em>tx</em> et <em>time5</em>) en plus de l’interaction (<em>tx x time5</em>). Or, il n’est <strong>pas possible d’estimer dans ce modèle le terme principal <em>time5</em> puisque la notion de temps fait également partie de l’issue</strong>. Vous devrez donc indiquer à R de retirer ce terme principal simplement en ajoutant <code>- time5</code> dans votre modèle. De cette manière, ce terme ne sera pas inclus.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="analyses-de-survie.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nous commencons par créer un prédicteur &quot;temps&quot; que nous avons nommé time et qui prend les valeurs 0-5 days vs. &gt;5 days</span></span>
<span id="cb381-2"><a href="analyses-de-survie.html#cb381-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>time5 <span class="ot">&lt;-</span> <span class="fu">cut</span>(pgtrial<span class="sc">$</span>dar, </span>
<span id="cb381-3"><a href="analyses-de-survie.html#cb381-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="cn">Inf</span>),</span>
<span id="cb381-4"><a href="analyses-de-survie.html#cb381-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0-5 days&quot;</span>, </span>
<span id="cb381-5"><a href="analyses-de-survie.html#cb381-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;&gt;5 days&quot;</span></span>
<span id="cb381-6"><a href="analyses-de-survie.html#cb381-6" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb381-7"><a href="analyses-de-survie.html#cb381-7" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb381-8"><a href="analyses-de-survie.html#cb381-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-9"><a href="analyses-de-survie.html#cb381-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensuite, nous pouvons tester une interaction entre time et tx</span></span>
<span id="cb381-10"><a href="analyses-de-survie.html#cb381-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb381-11"><a href="analyses-de-survie.html#cb381-11" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb381-12"><a href="analyses-de-survie.html#cb381-12" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx<span class="sc">*</span>time5 <span class="sc">-</span>time5 <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb381-13"><a href="analyses-de-survie.html#cb381-13" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb381-14"><a href="analyses-de-survie.html#cb381-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx * time5 - time5 + lact + 
##     thin + herd, data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##                       coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
## tx                5.461468 235.442858   0.589539  9.264   &lt;2e-16 ***
## lact             -0.055402   0.946105   0.039061 -1.418    0.156    
## thin1            -0.170799   0.842991   0.138408 -1.234    0.217    
## herd2            -0.217645   0.804411   0.170209 -1.279    0.201    
## herd3            -0.037483   0.963211   0.176023 -0.213    0.831    
## tx:time5&gt;5 days  -5.638785   0.003557   0.595293 -9.472   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                  exp(coef) exp(-coef) lower .95 upper .95
## tx              235.442858   0.004247 74.142836 747.65604
## lact              0.946105   1.056966  0.876376   1.02138
## thin1             0.842991   1.186252  0.642702   1.10570
## herd2             0.804411   1.243146  0.576229   1.12295
## herd3             0.963211   1.038194  0.682166   1.36004
## tx:time5&gt;5 days   0.003557 281.121076  0.001108   0.01142
## 
## Concordance= 0.663  (se = 0.021 )
## Likelihood ratio test= 199.5  on 6 df,   p=&lt;2e-16
## Wald test            = 96.56  on 6 df,   p=&lt;2e-16
## Score (logrank) test = 459.8  on 6 df,   p=&lt;2e-16</code></pre>
<p>Nous notons maintenant que, comme l’hypothèse que nous avions émise, le traitement aux prostaglandines augmente le hasard de conception dans le 5 jours suivant l’injection (HR= 235). Par contre, après 5 jours, l’effet semble minime. Le coefficient après 5 jours serait de -0.18 (i.e., 5.46 + -5.64), donc un HR de 0.84. L’interaction est significative (<em>P</em>&lt; 0.001). Ont pourrait demander des contrastes pour comparer ces derniers résultats.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="analyses-de-survie.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb383-2"><a href="analyses-de-survie.html#cb383-2" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère d&#39;abord l&#39;objet contrast à partir du modèle</span></span>
<span id="cb383-3"><a href="analyses-de-survie.html#cb383-3" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(PH_fit_pg, </span>
<span id="cb383-4"><a href="analyses-de-survie.html#cb383-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(<span class="st">&quot;tx&quot;</span>, <span class="st">&quot;time5&quot;</span>)</span>
<span id="cb383-5"><a href="analyses-de-survie.html#cb383-5" aria-hidden="true" tabindex="-1"></a>                    ) </span>
<span id="cb383-6"><a href="analyses-de-survie.html#cb383-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-7"><a href="analyses-de-survie.html#cb383-7" aria-hidden="true" tabindex="-1"></a><span class="co">#On demande les comparaisons pairées, Nous voulons voir Tx=1 vs Tx=0, nous avons donc du utiliser reverse=TRUE. Puis ajouter les IC95 avec confint</span></span>
<span id="cb383-8"><a href="analyses-de-survie.html#cb383-8" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">confint</span>(<span class="fu">pairs</span>(contrast, </span>
<span id="cb383-9"><a href="analyses-de-survie.html#cb383-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb383-10"><a href="analyses-de-survie.html#cb383-10" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb383-11"><a href="analyses-de-survie.html#cb383-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-12"><a href="analyses-de-survie.html#cb383-12" aria-hidden="true" tabindex="-1"></a><span class="co">#On retravaille les résultats pour la présentation. D&#39;abord en les mettant à l&#39;exposant pour avoir des HR, puis en arrondissant.</span></span>
<span id="cb383-13"><a href="analyses-de-survie.html#cb383-13" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>HR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>estimate), </span>
<span id="cb383-14"><a href="analyses-de-survie.html#cb383-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb383-15"><a href="analyses-de-survie.html#cb383-15" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb383-16"><a href="analyses-de-survie.html#cb383-16" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>lowCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>asymp.LCL), </span>
<span id="cb383-17"><a href="analyses-de-survie.html#cb383-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb383-18"><a href="analyses-de-survie.html#cb383-18" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb383-19"><a href="analyses-de-survie.html#cb383-19" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>hiCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>asymp.UCL), </span>
<span id="cb383-20"><a href="analyses-de-survie.html#cb383-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb383-21"><a href="analyses-de-survie.html#cb383-21" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb383-22"><a href="analyses-de-survie.html#cb383-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-23"><a href="analyses-de-survie.html#cb383-23" aria-hidden="true" tabindex="-1"></a><span class="co">#On ne conserve que les rangées (2 et 5) et les colonnes (1, 7, 8, 9) qui nous intéressent</span></span>
<span id="cb383-24"><a href="analyses-de-survie.html#cb383-24" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> result[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)]</span>
<span id="cb383-25"><a href="analyses-de-survie.html#cb383-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-26"><a href="analyses-de-survie.html#cb383-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb383-27"><a href="analyses-de-survie.html#cb383-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb383-28"><a href="analyses-de-survie.html#cb383-28" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (result2, </span>
<span id="cb383-29"><a href="analyses-de-survie.html#cb383-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;HR et IC95 d&#39;un traitement à la prostaglandine sur le risque de conception dans les 5 jours suivant le traitement vs. après 5 jours.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb383-30"><a href="analyses-de-survie.html#cb383-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-116">Table 9.1: </span>HR et IC95 d’un traitement à la prostaglandine sur le risque de conception dans les 5 jours suivant le traitement vs. après 5 jours.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
contrast
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:right;">
lowCI
</th>
<th style="text-align:right;">
hiCI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
(0-5 days tx1) - (0-5 days tx0)
</td>
<td style="text-align:right;">
235.44
</td>
<td style="text-align:right;">
51.78
</td>
<td style="text-align:right;">
1070.64
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
&gt;5 days tx1 - &gt;5 days tx0
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
1.20
</td>
</tr>
</tbody>
</table>
<p>Dans les 5 jours suivant l’injection le HR est de 235.44 (<em>IC95</em>: 51.78, 1070.64), alors qu’après 5 jours, le HR est de 0.84 (<em>IC95</em>: 0.59, 1.20).</p>
<p>Le code suivant permettrait d’évaluer une interaction avec le temps représentant un changement d’effet exponentiel durant la période de suivi (i.e., un effet qui diminue ou augmente graduellement, plutôt que de manière catégorique).</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="analyses-de-survie.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co">#On commence par créer un prédicteur &quot;temps&quot; logarithmique</span></span>
<span id="cb384-2"><a href="analyses-de-survie.html#cb384-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lntime <span class="ot">&lt;-</span> <span class="fu">log</span>(pgtrial<span class="sc">$</span>dar)</span>
<span id="cb384-3"><a href="analyses-de-survie.html#cb384-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-4"><a href="analyses-de-survie.html#cb384-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensuite, on peut tester une interaction entre lntime et tx</span></span>
<span id="cb384-5"><a href="analyses-de-survie.html#cb384-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb384-6"><a href="analyses-de-survie.html#cb384-6" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb384-7"><a href="analyses-de-survie.html#cb384-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx<span class="sc">*</span>lntime <span class="sc">-</span>lntime <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb384-8"><a href="analyses-de-survie.html#cb384-8" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb384-9"><a href="analyses-de-survie.html#cb384-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx * lntime - lntime + lact + 
##     thin + herd, data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##                 coef  exp(coef)   se(coef)       z Pr(&gt;|z|)    
## tx           8.04911 3131.01263    0.59026  13.636   &lt;2e-16 ***
## lact        -0.04273    0.95817    0.03956  -1.080    0.280    
## thin1       -0.11277    0.89336    0.14024  -0.804    0.421    
## herd2       -0.10207    0.90297    0.16959  -0.602    0.547    
## herd3       -0.10909    0.89665    0.17738  -0.615    0.539    
## tx:lntime   -1.80673    0.16419    0.13385 -13.498   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##           exp(coef) exp(-coef) lower .95 upper .95
## tx        3131.0126  0.0003194  984.5795 9956.7790
## lact         0.9582  1.0436592    0.8867    1.0354
## thin1        0.8934  1.1193698    0.6787    1.1760
## herd2        0.9030  1.1074618    0.6476    1.2590
## herd3        0.8967  1.1152585    0.6333    1.2694
## tx:lntime    0.1642  6.0904812    0.1263    0.2134
## 
## Concordance= 0.75  (se = 0.019 )
## Likelihood ratio test= 302.2  on 6 df,   p=&lt;2e-16
## Wald test            = 191.9  on 6 df,   p=&lt;2e-16
## Score (logrank) test = 448.9  on 6 df,   p=&lt;2e-16</code></pre>
<p>Ici aussi l’interaction est significative (<em>P</em>&lt;0.001). Au jour 1 (<em>lntime</em>=0), l’effet du tx est un HR de exp(8.05) ou 3131! Puis, l’effet du traitement en log(HR) diminue de -1.81 à chaque augmentation de 1 log jour. Pour mieux visualiser tout ça, une figure pourrait être utile.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="analyses-de-survie.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère le jeu de données avec les valeurs de temps qui nous intéressent (jours 1 à 90) et on y mets les coefficients dont nous avons besoin.</span></span>
<span id="cb386-2"><a href="analyses-de-survie.html#cb386-2" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tx=</span><span class="fl">8.04</span>, </span>
<span id="cb386-3"><a href="analyses-de-survie.html#cb386-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tx_lntime_int=</span><span class="sc">-</span><span class="fl">1.81</span>, </span>
<span id="cb386-4"><a href="analyses-de-survie.html#cb386-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">time=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span>
<span id="cb386-5"><a href="analyses-de-survie.html#cb386-5" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb386-6"><a href="analyses-de-survie.html#cb386-6" aria-hidden="true" tabindex="-1"></a>new<span class="sc">$</span>lntime <span class="ot">&lt;-</span> <span class="fu">log</span>(new<span class="sc">$</span>time)</span>
<span id="cb386-7"><a href="analyses-de-survie.html#cb386-7" aria-hidden="true" tabindex="-1"></a>new<span class="sc">$</span>hr <span class="ot">&lt;-</span> <span class="fu">exp</span>(new<span class="sc">$</span>tx <span class="sc">+</span> new<span class="sc">$</span>lntime<span class="sc">*</span>new<span class="sc">$</span>tx_lntime_int)</span>
<span id="cb386-8"><a href="analyses-de-survie.html#cb386-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-9"><a href="analyses-de-survie.html#cb386-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb386-10"><a href="analyses-de-survie.html#cb386-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new, </span>
<span id="cb386-11"><a href="analyses-de-survie.html#cb386-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>hr)</span>
<span id="cb386-12"><a href="analyses-de-survie.html#cb386-12" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb386-13"><a href="analyses-de-survie.html#cb386-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb386-14"><a href="analyses-de-survie.html#cb386-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb386-15"><a href="analyses-de-survie.html#cb386-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&quot;Hazard ratio&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-118"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-118-1.png" alt="Hazard ratio présentant l'effet de la prostaglandine sur le hasard de conception en fonction des jours suivant l'injection." width="672" />
<p class="caption">
Figure 9.2: Hazard ratio présentant l’effet de la prostaglandine sur le hasard de conception en fonction des jours suivant l’injection.
</p>
</div>
<p>On note que l’effet du traitement diminue rapidement. Notre modèle 0-5 <em>vs.</em> &gt;5 jours indiquait le même patron (et était peut-être aussi plus simple à expliquer?).</p>
</div>
</div>
<div id="évaluation-du-modèle-1" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Évaluation du modèle<a href="analyses-de-survie.html#évaluation-du-modèle-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="linéarité-de-la-relation-pour-les-prédicteurs-quantitatifs" class="section level3 hasAnchor" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> Linéarité de la relation (pour les prédicteurs quantitatifs)<a href="analyses-de-survie.html#linéarité-de-la-relation-pour-les-prédicteurs-quantitatifs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La linéarité de la relation est une supposition importante du modèle. Pour les prédicteurs quantitatifs, vous devrez toujours vérifier si cette supposition est bien respectée. Vous pouvez le faire simplement à l’aide du modèle polynomial comme vu précédemment (en ajoutant le <span class="math inline">\(prédicteur^2\)</span> ou le <span class="math inline">\(prédicteur^2\)</span> et le <span class="math inline">\(prédicteur^3\)</span> dans votre modèle).</p>
<p>Une autre possibilité est l’évaluation du <strong>graphique du prédicteur quantitatif que nous désirons évaluer par les résiduels de Martingdale d’un modèle sans le prédicteur quantitatif</strong>. Une fonction de lissage (comme vu précédemment) permettra de visualiser s’il y a une courbe ou non dans la relation. Les résiduels de Martingdale peuvent être obtenus avec la fonction <code>resid()</code>. La relation pourra être représentée avec la fonction <code>ggplot()</code> de la librairie <code>ggplot2</code>. Par exemple, le code suivant permet d’évaluer la linéarité de la relation entre la variable <em>lact</em> et le hasard de conception.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="analyses-de-survie.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Faire rouler le modèle sans le prédicteur continu lact</span></span>
<span id="cb387-2"><a href="analyses-de-survie.html#cb387-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_WO_lact <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb387-3"><a href="analyses-de-survie.html#cb387-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb387-4"><a href="analyses-de-survie.html#cb387-4" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb387-5"><a href="analyses-de-survie.html#cb387-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-6"><a href="analyses-de-survie.html#cb387-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajouter les résiduels de Martingale dans le jeu de données</span></span>
<span id="cb387-7"><a href="analyses-de-survie.html#cb387-7" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">resid</span>(PH_fit_pg_WO_lact) </span>
<span id="cb387-8"><a href="analyses-de-survie.html#cb387-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-9"><a href="analyses-de-survie.html#cb387-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb387-10"><a href="analyses-de-survie.html#cb387-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pgtrial, </span>
<span id="cb387-11"><a href="analyses-de-survie.html#cb387-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>lact, <span class="at">y=</span>res)</span>
<span id="cb387-12"><a href="analyses-de-survie.html#cb387-12" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb387-13"><a href="analyses-de-survie.html#cb387-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co">#On demande d&#39;ajouter le nuage de points (un &#39;scatterplot&#39;)</span></span>
<span id="cb387-14"><a href="analyses-de-survie.html#cb387-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;loess&quot;</span>, </span>
<span id="cb387-15"><a href="analyses-de-survie.html#cb387-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">span=</span><span class="dv">2</span></span>
<span id="cb387-16"><a href="analyses-de-survie.html#cb387-16" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span> <span class="co">#On demande d&#39;ajouter la courbe lissée de type loess. </span></span>
<span id="cb387-17"><a href="analyses-de-survie.html#cb387-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-119-1.png" alt="Graphique des résiduels de Martingdale en fonction de la parité." width="672" />
<p class="caption">
Figure 9.3: Graphique des résiduels de Martingdale en fonction de la parité.
</p>
</div>
<p>Dans cet exemple, on note que la relation est curvilinéaire. Notez que le modèle polynomial indique également que le terme au carré est important (<em>P</em> = 0.03) et que la relation n’était donc pas linéaire (voir le code qui suit).</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="analyses-de-survie.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Lactation centrée sur 2ième parité et au carré</span></span>
<span id="cb388-2"><a href="analyses-de-survie.html#cb388-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct <span class="ot">&lt;-</span> pgtrial<span class="sc">$</span>lact<span class="dv">-2</span></span>
<span id="cb388-3"><a href="analyses-de-survie.html#cb388-3" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct_sq <span class="ot">&lt;-</span> (pgtrial<span class="sc">$</span>lact<span class="dv">-2</span>)<span class="sc">*</span>(pgtrial<span class="sc">$</span>lact<span class="dv">-2</span>)</span>
<span id="cb388-4"><a href="analyses-de-survie.html#cb388-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-5"><a href="analyses-de-survie.html#cb388-5" aria-hidden="true" tabindex="-1"></a><span class="co">#La régression de cox avec termes polynomiaux</span></span>
<span id="cb388-6"><a href="analyses-de-survie.html#cb388-6" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_lact_sq <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb388-7"><a href="analyses-de-survie.html#cb388-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx <span class="sc">+</span> lact_ct <span class="sc">+</span> lact_ct_sq <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb388-8"><a href="analyses-de-survie.html#cb388-8" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb388-9"><a href="analyses-de-survie.html#cb388-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg_lact_sq)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx + lact_ct + lact_ct_sq + 
##     thin + herd, data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##                coef exp(coef) se(coef)      z Pr(&gt;|z|)  
## tx          0.19308   1.21298  0.12502  1.544   0.1225  
## lact_ct    -0.17281   0.84129  0.07193 -2.402   0.0163 *
## lact_ct_sq  0.04676   1.04787  0.02108  2.218   0.0266 *
## thin1      -0.09586   0.90859  0.13897 -0.690   0.4903  
## herd2      -0.29904   0.74153  0.16985 -1.761   0.0783 .
## herd3       0.01297   1.01305  0.17417  0.074   0.9406  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##            exp(coef) exp(-coef) lower .95 upper .95
## tx            1.2130     0.8244    0.9494    1.5498
## lact_ct       0.8413     1.1886    0.7307    0.9687
## lact_ct_sq    1.0479     0.9543    1.0054    1.0921
## thin1         0.9086     1.1006    0.6920    1.1930
## herd2         0.7415     1.3486    0.5316    1.0344
## herd3         1.0131     0.9871    0.7201    1.4252
## 
## Concordance= 0.571  (se = 0.02 )
## Likelihood ratio test= 14.66  on 6 df,   p=0.02
## Wald test            = 14.66  on 6 df,   p=0.02
## Score (logrank) test = 14.73  on 6 df,   p=0.02</code></pre>
</div>
<div id="valider-la-supposition-de-hasard-proportionnel" class="section level3 hasAnchor" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> Valider la supposition de hasard proportionnel<a href="analyses-de-survie.html#valider-la-supposition-de-hasard-proportionnel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La supposition de risque proportionnel peut être vérifiée en ajoutant une interaction avec le temps (comme présenté à la section “Prédicteur dont l’effet change dans le temps”). Cette interaction peut également être une solution lorsque la supposition de risque proportionnel n’est pas respectée. Mais il existe plusieurs autres méthodes afin de vérifier la supposition de risque proportionnel.</p>
<div id="pour-un-prédicteur-catégorique" class="section level4 hasAnchor" number="9.5.2.1">
<h4><span class="header-section-number">9.5.2.1</span> Pour un prédicteur catégorique:<a href="analyses-de-survie.html#pour-un-prédicteur-catégorique" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Option 1:</strong> Comparer graphiquement le log du hasard cumulatif ln H(t) par le log du temps pour chaque niveau du prédicteur. Ces droites devraient être parallèles si les hasards sont proportionnels. Le graphique ln H(t) * ln(t) peut être produit en: 1) faisant tourner un modèle de Kaplan-Meier avec juste la variable qui nous intéresse (<em>tx</em> dans l’exemple qui suit) à l’aide de la fonction <code>survfit()</code>, puis 2) en demandant de produire la figure à partir de cet objet à l’aide de la fonction <code>plot()</code> et de l’argument <code>fun=cloglog</code> (qui indique la figure désirée, c’est à dire ln H(t)*ln(t)).</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="analyses-de-survie.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb390-2"><a href="analyses-de-survie.html#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle de K-M avec la variable qui nous intéresse</span></span>
<span id="cb390-3"><a href="analyses-de-survie.html#cb390-3" aria-hidden="true" tabindex="-1"></a>KM_fit_pg <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb390-4"><a href="analyses-de-survie.html#cb390-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx</span>
<span id="cb390-5"><a href="analyses-de-survie.html#cb390-5" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb390-6"><a href="analyses-de-survie.html#cb390-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-7"><a href="analyses-de-survie.html#cb390-7" aria-hidden="true" tabindex="-1"></a><span class="co">#La figure ln(H(t)) par ln(temps)</span></span>
<span id="cb390-8"><a href="analyses-de-survie.html#cb390-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(KM_fit_pg, </span>
<span id="cb390-9"><a href="analyses-de-survie.html#cb390-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb390-10"><a href="analyses-de-survie.html#cb390-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">fun=</span><span class="st">&quot;cloglog&quot;</span>, </span>
<span id="cb390-11"><a href="analyses-de-survie.html#cb390-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;days&quot;</span>, </span>
<span id="cb390-12"><a href="analyses-de-survie.html#cb390-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Log(H(t))&quot;</span></span>
<span id="cb390-13"><a href="analyses-de-survie.html#cb390-13" aria-hidden="true" tabindex="-1"></a>     )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-121"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-121-1.png" alt="Graphique du log du hasard cumulatif (ln H(t)) par le log du temps (ln(t))." width="672" />
<p class="caption">
Figure 9.4: Graphique du log du hasard cumulatif (ln H(t)) par le log du temps (ln(t)).
</p>
</div>
<p>Ici, les droites ne sont clairement pas parallèles jusqu’à approximativement 20 à 50 jours.</p>
<p><strong>Option 2:</strong> comparer graphiquement les courbes de survie produites à l’aide du modèle de Cox (qui suppose hasard proportionnel) et d’une analyse de survie non-paramétrique (Kaplan-Meier; qui ne suppose rien). Les graphiques devraient être très similaires si les hasards sont proportionnels.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="analyses-de-survie.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb391-2"><a href="analyses-de-survie.html#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="co">#La courbe de survie de Kaplan-Meier</span></span>
<span id="cb391-3"><a href="analyses-de-survie.html#cb391-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(KM_fit_pg)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-122"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-122-1.png" alt="Courbes de survie de Kaplan-Meier pour la variable traitement." width="672" />
<p class="caption">
Figure 9.5: Courbes de survie de Kaplan-Meier pour la variable traitement.
</p>
</div>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="analyses-de-survie.html#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle de cox équivalent</span></span>
<span id="cb392-2"><a href="analyses-de-survie.html#cb392-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb392-3"><a href="analyses-de-survie.html#cb392-3" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb392-4"><a href="analyses-de-survie.html#cb392-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx</span>
<span id="cb392-5"><a href="analyses-de-survie.html#cb392-5" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb392-6"><a href="analyses-de-survie.html#cb392-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-7"><a href="analyses-de-survie.html#cb392-7" aria-hidden="true" tabindex="-1"></a><span class="co">#La courbe de survie de Cox</span></span>
<span id="cb392-8"><a href="analyses-de-survie.html#cb392-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggadjustedcurves</span>(PH_fit_pg, </span>
<span id="cb392-9"><a href="analyses-de-survie.html#cb392-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">variable=</span><span class="st">&quot;tx&quot;</span></span>
<span id="cb392-10"><a href="analyses-de-survie.html#cb392-10" aria-hidden="true" tabindex="-1"></a>                 )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-123"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-123-1.png" alt="Courbes de survie de Cox pour la variable traitement." width="672" />
<p class="caption">
Figure 9.6: Courbes de survie de Cox pour la variable traitement.
</p>
</div>
<p>Notez que les courbes de survie de Kaplan-Meier et de Cox sont passablement différentes entre 0 et 50 jours.</p>
</div>
<div id="pour-un-prédicteur-catégorique-ou-quantitatif" class="section level4 hasAnchor" number="9.5.2.2">
<h4><span class="header-section-number">9.5.2.2</span> Pour un prédicteur catégorique OU quantitatif<a href="analyses-de-survie.html#pour-un-prédicteur-catégorique-ou-quantitatif" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Une dernière approche qui permet d’évaluer la supposition de risque proportionnel et qui fonctionne pour des <strong>prédicteurs catégoriques OU quantitatifs</strong> est l’évaluation d’un graphique des résiduels de Schoenfeld par le logarithme du temps (t). Une fonction de lissage pourra être utilisée afin de visualiser la tendance générale. Si la supposition de risque proportionnel est respectée, une ligne de tendance horizontale (i.e. avec une pente=0) devrait être observée. Notez qu’un résiduel de Schoenfeld différent sera produit pour chacun des prédicteurs du modèle. Vous devrez donc utiliser le résiduel correspondant au prédicteur que vous désirez évaluer.</p>
<p>Pour générer cette figure, vous devrez d’abord créer votre objet modèle de Cox (à l’aide de la fonction <code>coxph()</code>). Puis, vous devez créer un nouvel objet à partir de celui-ci à l’aide de la fonction <code>cox.zph()</code> de la librairie <code>survival</code>. Finalement, à l’aide de la librairie <code>survminer</code> vous pourrez utiliser la fonction <code>ggcoxzph()</code> sur ce dernier objet. Dans l’exemple suivant, je vérifie la supposition de hasard proportionnel pour la variable <em>lact</em>.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="analyses-de-survie.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère le modèle de Cox</span></span>
<span id="cb393-2"><a href="analyses-de-survie.html#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb393-3"><a href="analyses-de-survie.html#cb393-3" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb393-4"><a href="analyses-de-survie.html#cb393-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb393-5"><a href="analyses-de-survie.html#cb393-5" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb393-6"><a href="analyses-de-survie.html#cb393-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-7"><a href="analyses-de-survie.html#cb393-7" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère l&#39;objet cox.zph</span></span>
<span id="cb393-8"><a href="analyses-de-survie.html#cb393-8" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(PH_fit_pg)</span>
<span id="cb393-9"><a href="analyses-de-survie.html#cb393-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-10"><a href="analyses-de-survie.html#cb393-10" aria-hidden="true" tabindex="-1"></a><span class="co">#On demande la figure spécifiquement pour la variable lact</span></span>
<span id="cb393-11"><a href="analyses-de-survie.html#cb393-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb393-12"><a href="analyses-de-survie.html#cb393-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(fit,</span>
<span id="cb393-13"><a href="analyses-de-survie.html#cb393-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">var=</span><span class="st">&quot;lact&quot;</span>) </span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<p>Dans ce cas, la ligne est très près d’être horizontale (i.e. pente=0). La supposition de hasard proportionnel est donc probablement respectée pour la variable <em>lact</em>. Notez que le résultat d’un test de Schoenfeld est également présenté. L’hypothèse nulle de ce test est que la pente n’est pas différente de zéro (i.e., la supposition de hasard proportionnel est respectée).</p>
<p>À titre d’exemple, voici la même analyse, mais pour la variable <em>tx</em>. Rappelez-vous, nous avons déjà identifié de différentes manières que la supposition de hasard proportionnel pour cette variable est problématique.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="analyses-de-survie.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb394-2"><a href="analyses-de-survie.html#cb394-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(fit, </span>
<span id="cb394-3"><a href="analyses-de-survie.html#cb394-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">var=</span><span class="st">&quot;tx&quot;</span></span>
<span id="cb394-4"><a href="analyses-de-survie.html#cb394-4" aria-hidden="true" tabindex="-1"></a>         ) </span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-125-1.png" width="672" /></p>
<p>Notez la courbe au tout début (i.e. entre 0 et 28 jours). Le test est près d’être significatif (<em>P</em> = 0.06).</p>
</div>
</div>
<div id="évaluer-impact-du-non-respect-de-la-supposition-de-censure-non-informative" class="section level3 hasAnchor" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> Évaluer impact du non-respect de la supposition de censure non-informative<a href="analyses-de-survie.html#évaluer-impact-du-non-respect-de-la-supposition-de-censure-non-informative" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>On ne peut évaluer si la supposition de censure non-informative est respectée, mais on peut cependant vérifier quel aurait été l’impact d’une censure informative. Pour cela, on doit modifier le jeu de données pour représenter les scénarios les plus extrêmes.<br />
- D’une part toutes les données censurées remplacées par un échec au moment de la censure (corrélation positive).<br />
- D’autre part, on pourrait remplacer la durée de suivi des données censurées par un temps lointain, mais plausible (corrélation négative).</p>
<p>Ensuite, on exécutera le modèle de Cox avec ces deux scénarios et on comparera les résultats obtenus à notre modèle initial. On se demandera:<br />
1) est-ce que les conclusions statistiques changent (e.g. un prédicteur n’est plus significatif)?<br />
2) est-ce que les ratio de hasard changent beaucoup (e.g. 2.0 vs. 2.2 ou 2.0 vs. 12.0)?</p>
<p>Par exemple:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="analyses-de-survie.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Impact de la censure</span></span>
<span id="cb395-2"><a href="analyses-de-survie.html#cb395-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-3"><a href="analyses-de-survie.html#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimés originaux</span></span>
<span id="cb395-4"><a href="analyses-de-survie.html#cb395-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb395-5"><a href="analyses-de-survie.html#cb395-5" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb395-6"><a href="analyses-de-survie.html#cb395-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb395-7"><a href="analyses-de-survie.html#cb395-7" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb395-8"><a href="analyses-de-survie.html#cb395-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-9"><a href="analyses-de-survie.html#cb395-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Corrélation positive complète</span></span>
<span id="cb395-10"><a href="analyses-de-survie.html#cb395-10" aria-hidden="true" tabindex="-1"></a><span class="co">#On créer une nouvelle variable où toutes les observations se terminent par l&#39;événement</span></span>
<span id="cb395-11"><a href="analyses-de-survie.html#cb395-11" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>preg2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb395-12"><a href="analyses-de-survie.html#cb395-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle avec cette variable</span></span>
<span id="cb395-13"><a href="analyses-de-survie.html#cb395-13" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_pos <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb395-14"><a href="analyses-de-survie.html#cb395-14" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">Surv</span>(dar, preg2) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb395-15"><a href="analyses-de-survie.html#cb395-15" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb395-16"><a href="analyses-de-survie.html#cb395-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-17"><a href="analyses-de-survie.html#cb395-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Corrélation négative complète</span></span>
<span id="cb395-18"><a href="analyses-de-survie.html#cb395-18" aria-hidden="true" tabindex="-1"></a><span class="co">#On créer une nouvelle variable où toutes les vaches non-gestantes auraient vécu jusqu&#39;à au moins 500 JEL sans conception avant d&#39;être finalement réformées</span></span>
<span id="cb395-19"><a href="analyses-de-survie.html#cb395-19" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>dar2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pgtrial<span class="sc">$</span>preg<span class="sc">==</span><span class="dv">1</span>,</span>
<span id="cb395-20"><a href="analyses-de-survie.html#cb395-20" aria-hidden="true" tabindex="-1"></a>                       pgtrial<span class="sc">$</span>dar,</span>
<span id="cb395-21"><a href="analyses-de-survie.html#cb395-21" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">500</span></span>
<span id="cb395-22"><a href="analyses-de-survie.html#cb395-22" aria-hidden="true" tabindex="-1"></a>                       ) </span>
<span id="cb395-23"><a href="analyses-de-survie.html#cb395-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle avec cette variable</span></span>
<span id="cb395-24"><a href="analyses-de-survie.html#cb395-24" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_neg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb395-25"><a href="analyses-de-survie.html#cb395-25" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">Surv</span>(dar2, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb395-26"><a href="analyses-de-survie.html#cb395-26" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb395-27"><a href="analyses-de-survie.html#cb395-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-28"><a href="analyses-de-survie.html#cb395-28" aria-hidden="true" tabindex="-1"></a><span class="co">#tableau récapitulatif</span></span>
<span id="cb395-29"><a href="analyses-de-survie.html#cb395-29" aria-hidden="true" tabindex="-1"></a>tableau <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">&quot;Estimés originaux&quot;</span><span class="ot">=</span><span class="fu">exp</span>(PH_fit_pg<span class="sc">$</span>coefficients), </span>
<span id="cb395-30"><a href="analyses-de-survie.html#cb395-30" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Corrélation positive complète&quot;</span><span class="ot">=</span><span class="fu">exp</span>(PH_fit_pg_pos<span class="sc">$</span>coefficients), </span>
<span id="cb395-31"><a href="analyses-de-survie.html#cb395-31" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Corrélation négative complète&quot;</span><span class="ot">=</span><span class="fu">exp</span>(PH_fit_pg_neg<span class="sc">$</span>coefficients)</span>
<span id="cb395-32"><a href="analyses-de-survie.html#cb395-32" aria-hidden="true" tabindex="-1"></a>                 ) </span>
<span id="cb395-33"><a href="analyses-de-survie.html#cb395-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-34"><a href="analyses-de-survie.html#cb395-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb395-35"><a href="analyses-de-survie.html#cb395-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb395-36"><a href="analyses-de-survie.html#cb395-36" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (<span class="fu">round</span>(tableau, </span>
<span id="cb395-37"><a href="analyses-de-survie.html#cb395-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb395-38"><a href="analyses-de-survie.html#cb395-38" aria-hidden="true" tabindex="-1"></a>             ), </span>
<span id="cb395-39"><a href="analyses-de-survie.html#cb395-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;HR d&#39;un traitement à la prostaglandine sur le risque de conception. Modèle initial, puis modèles supposant corrélation positive et négative complètes.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb395-40"><a href="analyses-de-survie.html#cb395-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-126">Table 9.2: </span>HR d’un traitement à la prostaglandine sur le risque de conception. Modèle initial, puis modèles supposant corrélation positive et négative complètes.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimés originaux
</th>
<th style="text-align:right;">
Corrélation positive complète
</th>
<th style="text-align:right;">
Corrélation négative complète
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
tx
</td>
<td style="text-align:right;">
1.22
</td>
<td style="text-align:right;">
1.26
</td>
<td style="text-align:right;">
1.12
</td>
</tr>
<tr>
<td style="text-align:left;">
lact
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.93
</td>
</tr>
<tr>
<td style="text-align:left;">
thin1
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
0.94
</td>
</tr>
<tr>
<td style="text-align:left;">
herd2
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.77
</td>
</tr>
<tr>
<td style="text-align:left;">
herd3
</td>
<td style="text-align:right;">
1.04
</td>
<td style="text-align:right;">
1.02
</td>
<td style="text-align:right;">
1.05
</td>
</tr>
</tbody>
</table>
<p>Ici, on note peu de différence des ratios de hasard d’un modèle à l’autre. Notez que la fonction <code>ggforest()</code> de la librairie <code>survminer</code> produit une autre manière de visualiser/comparer nos résultats rapidement. Par exemple, pour nos 3 modèles:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="analyses-de-survie.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb396-2"><a href="analyses-de-survie.html#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(PH_fit_pg, </span>
<span id="cb396-3"><a href="analyses-de-survie.html#cb396-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;HR modèle initial&quot;</span></span>
<span id="cb396-4"><a href="analyses-de-survie.html#cb396-4" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="analyses-de-survie.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(PH_fit_pg_pos, </span>
<span id="cb397-2"><a href="analyses-de-survie.html#cb397-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;HR corrélation positive complète&quot;</span></span>
<span id="cb397-3"><a href="analyses-de-survie.html#cb397-3" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-127-2.png" width="672" /></p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="analyses-de-survie.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(PH_fit_pg_neg, </span>
<span id="cb398-2"><a href="analyses-de-survie.html#cb398-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;HR corrélation négative complète&quot;</span></span>
<span id="cb398-3"><a href="analyses-de-survie.html#cb398-3" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-127-3.png" width="672" /></p>
</div>
<div id="observations-extrêmes" class="section level3 hasAnchor" number="9.5.4">
<h3><span class="header-section-number">9.5.4</span> Observations extrêmes<a href="analyses-de-survie.html#observations-extrêmes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Les résiduels de déviance peuvent être utilisés afin d’identifier les observations extrêmes. On peut les produire à l’aide de la fonction <code>resid()</code> en spécifiant <code>type="deviance"</code>. On pourra ensuite les représenter graphiquement en fonction du temps à l’aide de la fonction <code>ggplot()</code>. On devra aussi tenter d’identifier si ces observations ont un profil de prédicteurs et variable dépendante commun.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="analyses-de-survie.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajouter les résiduels de déviance à ma table</span></span>
<span id="cb399-2"><a href="analyses-de-survie.html#cb399-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>res.dev <span class="ot">&lt;-</span> <span class="fu">resid</span>(PH_fit_pg, </span>
<span id="cb399-3"><a href="analyses-de-survie.html#cb399-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type=</span><span class="st">&quot;deviance&quot;</span></span>
<span id="cb399-4"><a href="analyses-de-survie.html#cb399-4" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb399-5"><a href="analyses-de-survie.html#cb399-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-6"><a href="analyses-de-survie.html#cb399-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb399-7"><a href="analyses-de-survie.html#cb399-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pgtrial, </span>
<span id="cb399-8"><a href="analyses-de-survie.html#cb399-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dar, </span>
<span id="cb399-9"><a href="analyses-de-survie.html#cb399-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>res.dev)</span>
<span id="cb399-10"><a href="analyses-de-survie.html#cb399-10" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb399-11"><a href="analyses-de-survie.html#cb399-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb399-12"><a href="analyses-de-survie.html#cb399-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-128"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-128-1.png" alt="Résiduels de déviance en fonction du temps." width="672" />
<p class="caption">
Figure 9.7: Résiduels de déviance en fonction du temps.
</p>
</div>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="analyses-de-survie.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nous pourrions maintenant filtrer cette table pour ne conserver que les résiduels standardisés larges (en fait, il n&#39;y en avait aucun &gt;3.0 ou &lt;-3.0)</span></span>
<span id="cb400-2"><a href="analyses-de-survie.html#cb400-2" aria-hidden="true" tabindex="-1"></a>res_large <span class="ot">&lt;-</span> <span class="fu">subset</span>(pgtrial, </span>
<span id="cb400-3"><a href="analyses-de-survie.html#cb400-3" aria-hidden="true" tabindex="-1"></a>                    (res.dev <span class="sc">&gt;=</span><span class="fl">2.0</span> <span class="sc">|</span> res.dev<span class="sc">&lt;=-</span><span class="fl">2.0</span>)</span>
<span id="cb400-4"><a href="analyses-de-survie.html#cb400-4" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb400-5"><a href="analyses-de-survie.html#cb400-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-6"><a href="analyses-de-survie.html#cb400-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (res_large,</span>
<span id="cb400-7"><a href="analyses-de-survie.html#cb400-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Observations avec les résiduels les plus larges.&quot;</span></span>
<span id="cb400-8"><a href="analyses-de-survie.html#cb400-8" aria-hidden="true" tabindex="-1"></a>       )<span class="sc">%&gt;%</span></span>
<span id="cb400-9"><a href="analyses-de-survie.html#cb400-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-129">Table 9.3: </span>Observations avec les résiduels les plus larges.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
herd
</th>
<th style="text-align:right;">
cow
</th>
<th style="text-align:right;">
tx
</th>
<th style="text-align:right;">
lact
</th>
<th style="text-align:left;">
thin
</th>
<th style="text-align:right;">
dar
</th>
<th style="text-align:right;">
preg
</th>
<th style="text-align:left;">
time5
</th>
<th style="text-align:right;">
lntime
</th>
<th style="text-align:right;">
res
</th>
<th style="text-align:right;">
lact_ct
</th>
<th style="text-align:right;">
lact_ct_sq
</th>
<th style="text-align:right;">
preg2
</th>
<th style="text-align:right;">
dar2
</th>
<th style="text-align:right;">
res.dev
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.9917920
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.734574
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.9916056
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.764111
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0.6931472
</td>
<td style="text-align:right;">
0.9778236
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.351804
</td>
</tr>
<tr>
<td style="text-align:left;">
73
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
277
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.6240175
</td>
<td style="text-align:right;">
-3.4421658
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.710981
</td>
</tr>
<tr>
<td style="text-align:left;">
74
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.9947488
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.902334
</td>
</tr>
<tr>
<td style="text-align:left;">
75
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
79
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.9923152
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.813330
</td>
</tr>
<tr>
<td style="text-align:left;">
76
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0.6931472
</td>
<td style="text-align:right;">
0.9830284
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.467808
</td>
</tr>
<tr>
<td style="text-align:left;">
176
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
180
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
201
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.3033049
</td>
<td style="text-align:right;">
-2.0393102
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.028332
</td>
</tr>
<tr>
<td style="text-align:left;">
180
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
184
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.5214609
</td>
<td style="text-align:right;">
-2.4248224
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.208513
</td>
</tr>
<tr>
<td style="text-align:left;">
183
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
288
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.6629605
</td>
<td style="text-align:right;">
-2.2021736
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.090547
</td>
</tr>
<tr>
<td style="text-align:left;">
185
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
189
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
346
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.8464388
</td>
<td style="text-align:right;">
-2.3808125
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.237670
</td>
</tr>
<tr>
<td style="text-align:left;">
314
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
318
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
262
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.5683445
</td>
<td style="text-align:right;">
-2.4382604
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.277784
</td>
</tr>
<tr>
<td style="text-align:left;">
315
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
319
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
262
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.5683445
</td>
<td style="text-align:right;">
-2.4382604
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.228663
</td>
</tr>
<tr>
<td style="text-align:left;">
316
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
320
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
287
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.6594822
</td>
<td style="text-align:right;">
-2.5542742
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.182537
</td>
</tr>
<tr>
<td style="text-align:left;">
317
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
321
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
288
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.6629605
</td>
<td style="text-align:right;">
-2.5542742
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.279806
</td>
</tr>
<tr>
<td style="text-align:left;">
318
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
322
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
308
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.7300998
</td>
<td style="text-align:right;">
-2.8241677
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.342337
</td>
</tr>
<tr>
<td style="text-align:left;">
319
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
323
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
320
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
5.7683210
</td>
<td style="text-align:right;">
-2.8241677
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
-2.393963
</td>
</tr>
</tbody>
</table>
</div>
<div id="observations-influentes" class="section level3 hasAnchor" number="9.5.5">
<h3><span class="header-section-number">9.5.5</span> Observations influentes<a href="analyses-de-survie.html#observations-influentes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Les résiduels de score ou les delta-betas peuvent être utilisés afin d’identifier les observations influentes. Notez que, comme pour les résiduels de Schoenfeld, un résiduel de score (et un delta-beta) différent sera produit pour chacun des prédicteurs du modèle. Vous devrez donc utiliser le résiduel correspondant au prédicteur que vous désirez évaluer.</p>
<p>On peut également les produire à l’aide de la fonction <code>resid()</code>, l’argument <code>type="score"</code> génèrera les résiduels de Score. <code>type="dfbetas"</code> sera utilisé pour les delta-betas. On pourra ensuite les représenter graphiquement en fonction du temps à l’aide de la fonction <code>ggplot()</code>. Lorsque représentés en fonction du temps, ces résiduels ressembleront à un genre de « ventilateur ». Les points en dehors du ventilateur seront les plus influents. On devra tenter d’identifier si ces observations ont un profil de prédicteurs et de variable dépendante particulier.</p>
<p>Le code suivant permettra, par exemple, de produire les résiduels de score pour chacun des prédicteurs et de visualiser la figure pour la variable <em>tx</em>. Pour la figure, j’ai utilisé la librairie <code>ggrepel</code> et la fonction <code>geom_text_repel()</code> qui me permet d’identifier les points sur la figure.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="analyses-de-survie.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Créer les résiduels de déviance dans une table</span></span>
<span id="cb401-2"><a href="analyses-de-survie.html#cb401-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">resid</span>(PH_fit_pg, </span>
<span id="cb401-3"><a href="analyses-de-survie.html#cb401-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type=</span><span class="st">&quot;score&quot;</span></span>
<span id="cb401-4"><a href="analyses-de-survie.html#cb401-4" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb401-5"><a href="analyses-de-survie.html#cb401-5" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb401-6"><a href="analyses-de-survie.html#cb401-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-7"><a href="analyses-de-survie.html#cb401-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Joindre ces éléments dans la table initiale</span></span>
<span id="cb401-8"><a href="analyses-de-survie.html#cb401-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Renommer les variables</span></span>
<span id="cb401-9"><a href="analyses-de-survie.html#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb401-10"><a href="analyses-de-survie.html#cb401-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(y, </span>
<span id="cb401-11"><a href="analyses-de-survie.html#cb401-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">old =</span> <span class="fu">c</span>(<span class="st">&#39;tx&#39;</span>,<span class="st">&#39;lact&#39;</span>, <span class="st">&#39;thin1&#39;</span>, <span class="st">&#39;herd2&#39;</span>, <span class="st">&#39;herd3&#39;</span>), </span>
<span id="cb401-12"><a href="analyses-de-survie.html#cb401-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">c</span>(<span class="st">&#39;score_tx&#39;</span>,<span class="st">&#39;score_lact&#39;</span>, <span class="st">&#39;score_thin&#39;</span>, <span class="st">&#39;score_herd2&#39;</span>, <span class="st">&#39;score_herd3&#39;</span>)</span>
<span id="cb401-13"><a href="analyses-de-survie.html#cb401-13" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb401-14"><a href="analyses-de-survie.html#cb401-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-15"><a href="analyses-de-survie.html#cb401-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Combiner les tables</span></span>
<span id="cb401-16"><a href="analyses-de-survie.html#cb401-16" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pgtrial, </span>
<span id="cb401-17"><a href="analyses-de-survie.html#cb401-17" aria-hidden="true" tabindex="-1"></a>           y) </span>
<span id="cb401-18"><a href="analyses-de-survie.html#cb401-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-19"><a href="analyses-de-survie.html#cb401-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualiser résiduels de score de tx en fonction du temps</span></span>
<span id="cb401-20"><a href="analyses-de-survie.html#cb401-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb401-21"><a href="analyses-de-survie.html#cb401-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb401-22"><a href="analyses-de-survie.html#cb401-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>a, </span>
<span id="cb401-23"><a href="analyses-de-survie.html#cb401-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dar, </span>
<span id="cb401-24"><a href="analyses-de-survie.html#cb401-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>score_tx</span>
<span id="cb401-25"><a href="analyses-de-survie.html#cb401-25" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb401-26"><a href="analyses-de-survie.html#cb401-26" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb401-27"><a href="analyses-de-survie.html#cb401-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb401-28"><a href="analyses-de-survie.html#cb401-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb401-29"><a href="analyses-de-survie.html#cb401-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> cow))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-130"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-130-1.png" alt="Résiduels de score de la variable TX en fonction du temps." width="672" />
<p class="caption">
Figure 9.8: Résiduels de score de la variable TX en fonction du temps.
</p>
</div>
</div>
</div>
<div id="pour-aller-plus-loin" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Pour aller plus loin<a href="analyses-de-survie.html#pour-aller-plus-loin" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="erreurs-types-robustes" class="section level3 hasAnchor" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> Erreurs-types robustes<a href="analyses-de-survie.html#erreurs-types-robustes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Lorsqu’il y a regroupement des observations (e.g. des animaux regroupés en troupeaux), la supposition d’indépendance des observations n’est pas respectée. Comme vu au cours, on pourra remédier à ce problème en incluant la variable « groupe » (e.g. l’identifiant du troupeau) comme prédicteur ou en stratifiant l’analyse de Cox par cette variable. Les erreurs-types robustes peuvent aussi être utilisées pour régler ce problème. L’argument <code>cluster()</code> permettra le calcul des erreurs-types robustes. On indiquera entre parenthèses une variable décrivant l’unité d’analyse (ici la vache).</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="analyses-de-survie.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb402-2"><a href="analyses-de-survie.html#cb402-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb402-3"><a href="analyses-de-survie.html#cb402-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> <span class="fu">cluster</span>(cow)</span>
<span id="cb402-4"><a href="analyses-de-survie.html#cb402-4" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb402-5"><a href="analyses-de-survie.html#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx + lact + thin, data = pgtrial, 
##     cluster = cow)
## 
##   n= 319, number of events= 264 
## 
##           coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)
## tx     0.15620   1.16906  0.12371   0.12261  1.274    0.203
## lact  -0.05054   0.95071  0.04020   0.03820 -1.323    0.186
## thin1 -0.10009   0.90476  0.12556   0.12347 -0.811    0.418
## 
##       exp(coef) exp(-coef) lower .95 upper .95
## tx       1.1691     0.8554    0.9193     1.487
## lact     0.9507     1.0518    0.8821     1.025
## thin1    0.9048     1.1053    0.7103     1.152
## 
## Concordance= 0.547  (se = 0.021 )
## Likelihood ratio test= 4.4  on 3 df,   p=0.2
## Wald test            = 4.28  on 3 df,   p=0.2
## Score (logrank) test = 4.38  on 3 df,   p=0.2,   Robust = 4.32  p=0.2
## 
##   (Note: the likelihood ratio and score tests assume independence of
##      observations within a cluster, the Wald and robust score tests do not).</code></pre>
</div>
<div id="régression-de-cox-à-fragilité-partagée" class="section level3 hasAnchor" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Régression de Cox à fragilité partagée<a href="analyses-de-survie.html#régression-de-cox-à-fragilité-partagée" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Un modèle de régression de Cox à fragilité partagée peut-être utilisé afin de prendre en compte le regroupement des observations (i.e., la dépendance entre les observations). L’argument <code>frailty()</code> permettra d’indiquer comment les données sont regroupées (i.e. permet d’ajouter un effet aléatoire groupe). Notez qu’on ne pourra indiquer qu’un seul niveau de regroupement (e.g., vaches regroupées par troupeaux).</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="analyses-de-survie.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb404-2"><a href="analyses-de-survie.html#cb404-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb404-3"><a href="analyses-de-survie.html#cb404-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> <span class="fu">frailty</span>(herd)</span>
<span id="cb404-4"><a href="analyses-de-survie.html#cb404-4" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb404-5"><a href="analyses-de-survie.html#cb404-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx + lact + thin + frailty(herd), 
##     data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##               coef     se(coef) se2     Chisq DF   p    
## tx             0.17683 0.12456  0.12417 2.02  1.00 0.160
## lact          -0.04668 0.04058  0.04034 1.32  1.00 0.250
## thin1         -0.12589 0.13067  0.12774 0.93  1.00 0.340
## frailty(herd)                           2.75  0.91 0.086
## 
##         exp(coef) exp(-coef) lower .95 upper .95
## tx         1.1934     0.8379    0.9349     1.523
## lact       0.9544     1.0478    0.8814     1.033
## thin1      0.8817     1.1342    0.6825     1.139
## gamma:1    1.0349     0.9663    0.8691     1.232
## gamma:2    0.9016     1.1091    0.7568     1.074
## gamma:3    1.0635     0.9403    0.8984     1.259
## 
## Iterations: 7 outer, 20 Newton-Raphson
##      Variance of random effect= 0.01113406   I-likelihood = -1307.3 
## Degrees of freedom for terms= 1.0 1.0 1.0 0.9 
## Concordance= 0.56  (se = 0.02 )
## Likelihood ratio test= 8.57  on 3.85 df,   p=0.07</code></pre>
</div>
</div>
<div id="travaux-pratiques-8---analyses-de-survie-non-paramétriques" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> Travaux pratiques 8 - Analyses de survie non-paramétriques<a href="analyses-de-survie.html#travaux-pratiques-8---analyses-de-survie-non-paramétriques" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="exercices-7" class="section level3 hasAnchor" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> Exercices<a href="analyses-de-survie.html#exercices-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour ce TP utilisez le fichier <em>pgtrial.csv</em> (voir description VER p.824).
Cette étude est un essai clinique randomisé sur l’effet de l’administration d’une dose de prostaglandine <em>vs.</em> d’un placebo (la variable <em>tx</em>; 0=placebo, 1=prostaglandines) au début de la période de reproduction sur le nombre de jours (la variable <em>dar</em>) jusqu’à la conception (la variable <em>preg</em>, 0=censure, 1=gestation). L’hypothèse était que l’administration de prostaglandine réduirait le nombre de jours jusqu’à la conception. Les 319 vaches de cette étude étaient suivies jusqu’à un maximum de 346 jours en lait. Trois autres prédicteurs étaient aussi évalués : la parité (<em>lact</em>; 1, 2, 3…), l’état de chair (<em>thin</em>; 0=normal, 1=maigre) et le troupeau d’appartenance (<em>herd</em>; 3 troupeaux).</p>
<ol style="list-style-type: decimal">
<li><p>Combien des 319 vaches ont réussi à concevoir et combien étaient toujours non-gestante (i.e. observations censurées) à la fin de la période de suivi?</p></li>
<li><p>Il y a donc passablement d’observations censurées dans ce jeu de données, une analyse de survie serait donc appropriée. Produisez la table et le graphique de survie de Kaplan-Meier.</p></li>
</ol>
<p>2.1. Quelle proportion et quel nombre de vaches avaient « survécu » (i.e. n’avait pas eu de conception) à 5 jours suivant l’administration des traitements? Notez que, suite à l’administration de prostaglandines, une chaleur est souvent induite dans les 2-5 jours, suivant l’injection.</p>
<p>2.2. Quel était le temps médian jusqu’à la conception et quel était son <em>IC95%</em>?</p>
<ol start="3" style="list-style-type: decimal">
<li>Comparez maintenant les fonctions de survie des vaches ayant reçu la prostaglandine <em>vs.</em> le placebo.</li>
</ol>
<p>3.1. Visuellement que notez-vous lorsque vous comparez les fonctions de survie de ces deux groupes de vaches?</p>
<p>3.2. Quelles étaient les proportions de vaches gestantes dans les groupes prostaglandines <em>vs.</em> placebo aux jours 5, 26 et 100?</p>
<p>3.3. Les fonctions de survie des deux groupes de traitement sont-elles statistiquement différentes?</p>
<p>3.4. Comme la conception est, en général, un événement positif, les chercheurs trouveraient plus approprié de présenter la fonction d’échec plutôt que la fonction de survie dans leur article. Représentez les fonctions d’échec des groupes prostaglandines et placebo avec leurs <em>IC95%</em>. Que représente maintenant l’axe des Y?</p>
<p>3.5. Lorsque vous comparez l’<em>IC95%</em> de la fonction d’échec de Kaplan-Meier du groupe prostaglandines à la fonction d’échec du groupe placebo. Arrivez-vous aux mêmes conclusions que celles obtenues à l’aide des tests de Wilcoxon et Log-rank?</p>
<p>3.6. Comparez finalement les fonctions de survie (ou d’échec) entre les groupes de traitement, mais par troupeau d’appartenance.</p>
</div>
<div id="code-r-et-réponses-7" class="section level3 hasAnchor" number="9.7.2">
<h3><span class="header-section-number">9.7.2</span> Code R et réponses<a href="analyses-de-survie.html#code-r-et-réponses-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour ce TP utilisez le fichier <em>pgtrial.csv</em> (voir description VER p.824).
Cette étude est un essai clinique randomisé sur l’effet de l’administration d’une dose de prostaglandine <em>vs.</em> d’un placebo (la variable <em>tx</em>; 0=placebo, 1=prostaglandines) au début de la période de reproduction sur le nombre de jours (la variable <em>dar</em>) jusqu’à la conception (la variable <em>preg</em>, 0=censure, 1=gestation). L’hypothèse était que l’administration de prostaglandine réduirait le nombre de jours jusqu’à la conception. Les 319 vaches de cette étude étaient suivies jusqu’à un maximum de 346 jours en lait. Trois autres prédicteurs étaient aussi évalués : la parité (<em>lact</em>; 1, 2, 3…), l’état de chair (<em>thin</em>; 0=normal, 1=maigre) et le troupeau d’appartenance (<em>herd</em>; 3 troupeaux).</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="analyses-de-survie.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="co">#On importe la base de données</span></span>
<span id="cb406-2"><a href="analyses-de-survie.html#cb406-2" aria-hidden="true" tabindex="-1"></a>pgtrial <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">&quot;pgtrial.csv&quot;</span>, </span>
<span id="cb406-3"><a href="analyses-de-survie.html#cb406-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb406-4"><a href="analyses-de-survie.html#cb406-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sep=</span><span class="st">&quot;;&quot;</span></span>
<span id="cb406-5"><a href="analyses-de-survie.html#cb406-5" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb406-6"><a href="analyses-de-survie.html#cb406-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-7"><a href="analyses-de-survie.html#cb406-7" aria-hidden="true" tabindex="-1"></a><span class="co">#On indique les variables catégoriques du jeu de données</span></span>
<span id="cb406-8"><a href="analyses-de-survie.html#cb406-8" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>thin <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>thin) </span>
<span id="cb406-9"><a href="analyses-de-survie.html#cb406-9" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>tx <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>tx) </span>
<span id="cb406-10"><a href="analyses-de-survie.html#cb406-10" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>herd <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>herd) </span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Combien des 319 vaches ont réussi à concevoir et combien étaient toujours non-gestante (i.e. observations censurées) à la fin de la période de suivi?</li>
</ol>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="analyses-de-survie.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb407-2"><a href="analyses-de-survie.html#cb407-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dfSummary</span>(pgtrial<span class="sc">$</span>preg), </span>
<span id="cb407-3"><a href="analyses-de-survie.html#cb407-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">method=</span><span class="st">&#39;render&#39;</span></span>
<span id="cb407-4"><a href="analyses-de-survie.html#cb407-4" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<div class="container st-container">
<h3>Data Frame Summary</h3>
<h4>pgtrial</h4>
<strong>Dimensions</strong>: 319 x 1
  <br/><strong>Duplicates</strong>: 317
<br/>
<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
  <thead>
    <tr>
      <th align="center" class="st-protect-top-border"><strong>No</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Variable</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Stats / Values</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Freqs (% of Valid)</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Graph</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Valid</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Missing</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="center">1</td>
      <td align="left">pgtrial
[integer]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Min  : 0</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean : 0.8</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Max  : 1</td></tr></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">0</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">55</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">17.2%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">264</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">82.8%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAIgAAAA3BAMAAAAlCB/BAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5wETFAgb4coYEwAAAExJREFUSMdjYBgF2IASMlAUJBFADVE2RgKjhowaMmrIqCGjhlDVEKoU1KRqG+SGKFEEsMUOqcBo1JBRQ0YNGTVk1BB8hlCloB4FqAAANmWRjOqqJRkAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDEtMTlUMjA6MDg6MjcrMDA6MDDN4DPdAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTAxLTE5VDIwOjA4OjI3KzAwOjAwvL2LYQAAAABJRU5ErkJggg=="></td>
      <td align="center">319
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
  </tbody>
</table>
<p>Generated by <a href='https://github.com/dcomtois/summarytools'>summarytools</a> 1.0.1 (<a href='https://www.r-project.org/'>R</a> version 4.2.0)<br/>2023-01-19</p>
</div>
<p><strong>Réponse:</strong> À la fin de la période de suivi, 264 vaches (83%) étaient gestantes et 55 étaient non-gestantes (17%).</p>
<ol start="2" style="list-style-type: decimal">
<li>Il y a donc passablement d’observations censurées dans ce jeu de données, une analyse de survie serait donc appropriée. Produisez la table et le graphique de survie de Kaplan-Meier.</li>
</ol>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="analyses-de-survie.html#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb408-2"><a href="analyses-de-survie.html#cb408-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-3"><a href="analyses-de-survie.html#cb408-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Produire la table de Kaplan-Meier</span></span>
<span id="cb408-4"><a href="analyses-de-survie.html#cb408-4" aria-hidden="true" tabindex="-1"></a>km_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb408-5"><a href="analyses-de-survie.html#cb408-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb408-6"><a href="analyses-de-survie.html#cb408-6" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb408-7"><a href="analyses-de-survie.html#cb408-7" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(km_fit)   #La fonction summary() permet de visualiser la table de Kaplan-Meier. Celle-ci est très longue (160 lignes) nous laissons donc en &quot;commentaire&quot; afin de ne pas surcharger ce document.</span></span>
<span id="cb408-8"><a href="analyses-de-survie.html#cb408-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-9"><a href="analyses-de-survie.html#cb408-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Produire la courbe de survie</span></span>
<span id="cb408-10"><a href="analyses-de-survie.html#cb408-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb408-11"><a href="analyses-de-survie.html#cb408-11" aria-hidden="true" tabindex="-1"></a>survie <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit, </span>
<span id="cb408-12"><a href="analyses-de-survie.html#cb408-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.int =</span> <span class="cn">TRUE</span></span>
<span id="cb408-13"><a href="analyses-de-survie.html#cb408-13" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb408-14"><a href="analyses-de-survie.html#cb408-14" aria-hidden="true" tabindex="-1"></a>survie<span class="sc">$</span>plot <span class="sc">+</span></span>
<span id="cb408-15"><a href="analyses-de-survie.html#cb408-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-293"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-293-1.png" alt="Courbe de survie de Kaplan-Meier." width="672" />
<p class="caption">
Figure 9.9: Courbe de survie de Kaplan-Meier.
</p>
</div>
<p>2.1. Quelle proportion et quel nombre de vaches avaient « survécu » (i.e. n’avait pas eu de conception) à 5 jours suivant l’administration des traitements? Notez que, suite à l’administration de prostaglandines, une chaleur est souvent induite dans les 2-5 jours, suivant l’injection.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="analyses-de-survie.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb409-2"><a href="analyses-de-survie.html#cb409-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb409-3"><a href="analyses-de-survie.html#cb409-3" aria-hidden="true" tabindex="-1"></a>                ), </span>
<span id="cb409-4"><a href="analyses-de-survie.html#cb409-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">times =</span> <span class="dv">5</span></span>
<span id="cb409-5"><a href="analyses-de-survie.html#cb409-5" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(dar, preg) ~ 1, data = pgtrial)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5    277      42    0.868  0.0189        0.832        0.906</code></pre>
<p><strong>Réponse:</strong> 86.8% (<em>IC95</em>: 83.2, 90.6) des vaches n’avaient pas encore eu une conception au jour 5.</p>
<p>2.2. Quel était le temps médian jusqu’à la conception et quel était son <em>IC95%</em>?</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="analyses-de-survie.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb411-2"><a href="analyses-de-survie.html#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Le temps médian de survie</span></span>
<span id="cb411-3"><a href="analyses-de-survie.html#cb411-3" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb411-4"><a href="analyses-de-survie.html#cb411-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb411-5"><a href="analyses-de-survie.html#cb411-5" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(dar, preg) ~ 1, data = pgtrial)
## 
##        n events median 0.95LCL 0.95UCL
## [1,] 319    264     68      55      77</code></pre>
<p><strong>Réponse:</strong> Le temps médian jusqu’à la conception était 68 jours (<em>IC95</em>: 55 à 77 jours).</p>
<ol start="3" style="list-style-type: decimal">
<li>Comparez maintenant les fonctions de survie des vaches ayant reçu la prostaglandine <em>vs.</em> le placebo.</li>
</ol>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="analyses-de-survie.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb413-2"><a href="analyses-de-survie.html#cb413-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-3"><a href="analyses-de-survie.html#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb413-4"><a href="analyses-de-survie.html#cb413-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx</span>
<span id="cb413-5"><a href="analyses-de-survie.html#cb413-5" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(dar, preg) ~ tx, data = pgtrial)
## 
##        n events median 0.95LCL 0.95UCL
## tx=0 168    139     69      58      81
## tx=1 151    125     66      44      84</code></pre>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="analyses-de-survie.html#cb415-1" aria-hidden="true" tabindex="-1"></a>km_fit_pg <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb415-2"><a href="analyses-de-survie.html#cb415-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx</span>
<span id="cb415-3"><a href="analyses-de-survie.html#cb415-3" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb415-4"><a href="analyses-de-survie.html#cb415-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-5"><a href="analyses-de-survie.html#cb415-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb415-6"><a href="analyses-de-survie.html#cb415-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(km_fit_pg, </span>
<span id="cb415-7"><a href="analyses-de-survie.html#cb415-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">conf.int =</span> <span class="cn">TRUE</span></span>
<span id="cb415-8"><a href="analyses-de-survie.html#cb415-8" aria-hidden="true" tabindex="-1"></a>           )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-296"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-296-1.png" alt="Courbes de survie de Kaplan-Meier pour la variable traitement." width="672" />
<p class="caption">
Figure 9.10: Courbes de survie de Kaplan-Meier pour la variable traitement.
</p>
</div>
<p>3.1. Visuellement que notez-vous lorsque vous comparez les fonctions de survie de ces deux groupes de vaches?<br />
<strong>Réponse:</strong> On note que les fonctions diffèrent passablement très tôt suite au traitement. Par la suite, les fonctions deviennent de plus en plus similaires et sont assez équivalentes à partir du jour 75, environ.</p>
<p>3.2. Quelles étaient les proportions de vaches gestantes dans les groupes prostaglandines <em>vs.</em> placebo aux jours 5, 26 et 100?</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="analyses-de-survie.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb416-2"><a href="analyses-de-survie.html#cb416-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx</span>
<span id="cb416-3"><a href="analyses-de-survie.html#cb416-3" aria-hidden="true" tabindex="-1"></a>                ), </span>
<span id="cb416-4"><a href="analyses-de-survie.html#cb416-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">26</span>, <span class="dv">100</span>)</span>
<span id="cb416-5"><a href="analyses-de-survie.html#cb416-5" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(dar, preg) ~ tx, data = pgtrial)
## 
##                 tx=0 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5    165       4    0.976  0.0118        0.953        1.000
##    26    127      38    0.749  0.0336        0.686        0.817
##   100     54      62    0.360  0.0380        0.292        0.442
## 
##                 tx=1 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5    112      38    0.748  0.0354        0.682        0.821
##    26    104       9    0.687  0.0378        0.617        0.766
##   100     43      50    0.326  0.0398        0.257        0.415</code></pre>
<p><strong>Réponse:</strong> la proportion de vaches gestantes serait l’inverse de la probabilité de survie. Donc:<br />
- À 5 jours: placebo 2.4% (<em>IC95</em>: 0, 4.7), prostaglandine 25.2% (<em>IC95</em>: 17.9, 31.8)<br />
- À 26 jours: placebo 25.1% (<em>IC95</em>: 18.3, 31.4), prostaglandine 31.3% (<em>IC95</em>: 23.4, 38.3)<br />
- À 100 jours: placebo 64.0% (<em>IC95</em>: 55.8, 70.8), prostaglandine 67.4% (<em>IC95</em>: 58.5, 74.3)</p>
<p>3.3. Les fonctions de survie des deux groupes de traitement sont-elles statistiquement différentes?</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="analyses-de-survie.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb418-2"><a href="analyses-de-survie.html#cb418-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb418-3"><a href="analyses-de-survie.html#cb418-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx,  </span>
<span id="cb418-4"><a href="analyses-de-survie.html#cb418-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">0</span></span>
<span id="cb418-5"><a href="analyses-de-survie.html#cb418-5" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(dar, preg) ~ tx, data = pgtrial, rho = 0)
## 
##        N Observed Expected (O-E)^2/E (O-E)^2/V
## tx=0 168      139      149     0.677      1.59
## tx=1 151      125      115     0.878      1.59
## 
##  Chisq= 1.6  on 1 degrees of freedom, p= 0.2</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="analyses-de-survie.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb420-2"><a href="analyses-de-survie.html#cb420-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx,  </span>
<span id="cb420-3"><a href="analyses-de-survie.html#cb420-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">1</span></span>
<span id="cb420-4"><a href="analyses-de-survie.html#cb420-4" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(dar, preg) ~ tx, data = pgtrial, rho = 1)
## 
##        N Observed Expected (O-E)^2/E (O-E)^2/V
## tx=0 168     75.4     85.5      1.18      3.96
## tx=1 151     77.6     67.6      1.50      3.96
## 
##  Chisq= 4  on 1 degrees of freedom, p= 0.05</code></pre>
<p><strong>Réponse:</strong> Le test de Wilcoxon indique que les fonctions de survie sont différentes (<em>P</em> = 0.05), mais le test de Log-rank indique qu’elles ne sont pas différentes (<em>P</em> = 0.20). Les résultats sont mitigés parce que dans ce cas, les différences étaient surtout observées dans les premiers jours suivant le traitement (ce que le test de Wilcoxon a retenu). En fait, nos connaissances en physiologie de la reproduction supporteraient un effet important des prostaglandines dans les 2-5 jours suivants l’injection. Par la suite, il serait surprenant de voir un quelconque effet positif.</p>
<p>Le test de Log-rank assigne le même poids à tous les points dans le temps. Pour ce test, les différences entre groupes aux jours 100, 150 ou même 200 sont donc aussi importantes que les différences au jour 5. Le test de Wilcoxon, par contre, donnera plus de poids aux premières périodes de temps lorsque la taille d’échantillon est encore large.</p>
<p>3.4. Comme la conception est, en général, un événement positif, les chercheurs trouveraient plus approprié de présenter la fonction d’échec plutôt que la fonction de survie dans leur article. Représentez les fonctions d’échec des groupes prostaglandines et placebo avec leurs <em>IC95%</em>. Que représente maintenant l’axe des Y?</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="analyses-de-survie.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb422-2"><a href="analyses-de-survie.html#cb422-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(km_fit_pg, </span>
<span id="cb422-3"><a href="analyses-de-survie.html#cb422-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb422-4"><a href="analyses-de-survie.html#cb422-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fun =</span> <span class="st">&quot;event&quot;</span></span>
<span id="cb422-5"><a href="analyses-de-survie.html#cb422-5" aria-hidden="true" tabindex="-1"></a>           )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-299"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-299-1.png" alt="Courbes d'échec de Kaplan-Meier pour la variable traitement." width="672" />
<p class="caption">
Figure 9.11: Courbes d’échec de Kaplan-Meier pour la variable traitement.
</p>
</div>
<p><strong>Réponse:</strong> L’axe des Y représente maintenant la probabilité de conception (plutôt que la probabilité de non-conception).</p>
<p>3.5. Lorsque vous comparez l’<em>IC95%</em> de la fonction d’échec de Kaplan-Meier du groupe prostaglandines à la fonction d’échec du groupe placebo. Arrivez-vous aux mêmes conclusions que celles obtenues à l’aide des tests de Wilcoxon et Log-rank?</p>
<p><strong>Réponse:</strong> Oui, on voit que c’est en début de suivi que l’<em>IC95</em> du groupe prostaglandines n’inclus pas la fonction d’échec du groupe placebo. À partir du jour 25 environ l’<em>IC95</em> d’un groupe de traitement semble inclure la fonction de survie de l’autre, mais c’est encore plus clair à partir du jour 60 (approximativement). Nous avons ajouté des lignes de référence à 25 et 60 jours dans la figure plus bas afin d’illustrer ces observations.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="analyses-de-survie.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb423-2"><a href="analyses-de-survie.html#cb423-2" aria-hidden="true" tabindex="-1"></a>ggsurv <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit_pg, </span>
<span id="cb423-3"><a href="analyses-de-survie.html#cb423-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb423-4"><a href="analyses-de-survie.html#cb423-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fun =</span> <span class="st">&quot;event&quot;</span></span>
<span id="cb423-5"><a href="analyses-de-survie.html#cb423-5" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb423-6"><a href="analyses-de-survie.html#cb423-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-7"><a href="analyses-de-survie.html#cb423-7" aria-hidden="true" tabindex="-1"></a>ggsurv<span class="sc">$</span>plot <span class="sc">+</span></span>
<span id="cb423-8"><a href="analyses-de-survie.html#cb423-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">25</span>, </span>
<span id="cb423-9"><a href="analyses-de-survie.html#cb423-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb423-10"><a href="analyses-de-survie.html#cb423-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">60</span>, </span>
<span id="cb423-11"><a href="analyses-de-survie.html#cb423-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-300"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-300-1.png" alt="Courbes d'échec de Kaplan-Meier pour la variable traitement." width="672" />
<p class="caption">
Figure 9.12: Courbes d’échec de Kaplan-Meier pour la variable traitement.
</p>
</div>
<p>3.6. Comparez finalement les fonctions de survie (ou d’échec) entre les groupes de traitement, mais par troupeau d’appartenance.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="analyses-de-survie.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb424-2"><a href="analyses-de-survie.html#cb424-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-3"><a href="analyses-de-survie.html#cb424-3" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb424-4"><a href="analyses-de-survie.html#cb424-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> herd</span>
<span id="cb424-5"><a href="analyses-de-survie.html#cb424-5" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(dar, preg) ~ tx + herd, data = pgtrial)
## 
##               n events median 0.95LCL 0.95UCL
## tx=0, herd=1 36     34     70      54     103
## tx=0, herd=2 57     43     70      63      88
## tx=0, herd=3 75     62     67      43     105
## tx=1, herd=1 37     29     73      47     109
## tx=1, herd=2 55     42     88      49     118
## tx=1, herd=3 59     54     44      26      77</code></pre>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="analyses-de-survie.html#cb426-1" aria-hidden="true" tabindex="-1"></a>km_fit_pg <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb426-2"><a href="analyses-de-survie.html#cb426-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> herd</span>
<span id="cb426-3"><a href="analyses-de-survie.html#cb426-3" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb426-4"><a href="analyses-de-survie.html#cb426-4" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb426-5"><a href="analyses-de-survie.html#cb426-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> herd, </span>
<span id="cb426-6"><a href="analyses-de-survie.html#cb426-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">0</span></span>
<span id="cb426-7"><a href="analyses-de-survie.html#cb426-7" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(dar, preg) ~ tx + herd, data = pgtrial, 
##     rho = 0)
## 
##               N Observed Expected (O-E)^2/E (O-E)^2/V
## tx=0, herd=1 36       34     30.0     0.533     0.616
## tx=0, herd=2 57       43     48.9     0.713     0.894
## tx=0, herd=3 75       62     70.1     0.945     1.325
## tx=1, herd=1 37       29     26.2     0.296     0.338
## tx=1, herd=2 55       42     52.3     2.026     2.595
## tx=1, herd=3 59       54     36.5     8.450    10.145
## 
##  Chisq= 13.5  on 5 degrees of freedom, p= 0.02</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="analyses-de-survie.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb428-2"><a href="analyses-de-survie.html#cb428-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> herd, </span>
<span id="cb428-3"><a href="analyses-de-survie.html#cb428-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(dar, preg) ~ tx + herd, data = pgtrial, 
##     rho = 1)
## 
##               N Observed Expected (O-E)^2/E (O-E)^2/V
## tx=0, herd=1 36     17.4     18.0    0.0202    0.0337
## tx=0, herd=2 57     23.7     28.7    0.8981    1.6276
## tx=0, herd=3 75     34.3     38.7    0.4946    0.9882
## tx=1, herd=1 37     18.1     16.3    0.2004    0.3254
## tx=1, herd=2 55     25.0     28.1    0.3385    0.6322
## tx=1, herd=3 59     34.6     23.2    5.5361    9.3234
## 
##  Chisq= 10.8  on 5 degrees of freedom, p= 0.06</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="analyses-de-survie.html#cb430-1" aria-hidden="true" tabindex="-1"></a>ggsurv <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km_fit_pg, </span>
<span id="cb430-2"><a href="analyses-de-survie.html#cb430-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb430-3"><a href="analyses-de-survie.html#cb430-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fun=</span><span class="st">&quot;event&quot;</span></span>
<span id="cb430-4"><a href="analyses-de-survie.html#cb430-4" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb430-5"><a href="analyses-de-survie.html#cb430-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb430-6"><a href="analyses-de-survie.html#cb430-6" aria-hidden="true" tabindex="-1"></a>ggsurv<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb430-7"><a href="analyses-de-survie.html#cb430-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb430-8"><a href="analyses-de-survie.html#cb430-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span> (<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-9"><a href="analyses-de-survie.html#cb430-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> herd)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-301"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-301-1.png" alt="Courbes d'échec de Kaplan-Meier pour la variable traitement, par troupeau (1, 2 ou 3)." width="672" />
<p class="caption">
Figure 9.13: Courbes d’échec de Kaplan-Meier pour la variable traitement, par troupeau (1, 2 ou 3).
</p>
</div>
<p><strong>Réponse:</strong> Le log-rank est significatif (<em>P</em>=0.02). Mais on ne peut rapporter l’effet du traitement séparément de l’effet du troupeau. C’est plutôt un test de l’ensemble des catégories de traitement*troupeau. On voit que les analyses non-paramétriques sont donc assez limitées pour modéliser l’effet de 2 prédicteurs (même catégoriques).</p>
</div>
</div>
<div id="travaux-pratiques-9---analyses-de-survie-semi-paramétriques" class="section level2 hasAnchor" number="9.8">
<h2><span class="header-section-number">9.8</span> Travaux pratiques 9 - Analyses de survie semi-paramétriques<a href="analyses-de-survie.html#travaux-pratiques-9---analyses-de-survie-semi-paramétriques" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="exercices-8" class="section level3 hasAnchor" number="9.8.1">
<h3><span class="header-section-number">9.8.1</span> Exercices<a href="analyses-de-survie.html#exercices-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour ce TP utilisez le fichier <em>pgtrial.csv</em> (voir description VER p.824).</p>
<p>Cette étude est un essai clinique randomisé sur l’effet de l’administration d’une dose de prostaglandine vs. d’un placebo (<em>tx</em>) au début de la période de reproduction sur le nombre de jours (<em>dar</em>) jusqu’à la conception (<em>preg</em>). L’hypothèse était que l’administration de prostaglandine réduirait le nombre de jours jusqu’à la conception. Les 319 vaches de cette étude étaient suivies jusqu’à un maximum de 346 jours en lait. Trois autres prédicteurs étaient aussi évalués: le nombre de lactations (<em>lact</em>; 1, 2, 3…), l’état de chair (<em>thin</em>; 0=normal, 1=thin) et le troupeau (<em>herd</em>; 3 troupeaux).</p>
<p>Comme vous l’avez vu au dernier TP, les modèles non-paramétriques sont plutôt limités lorsque l’on désire évaluer l’effet de plus d’un prédicteur. Les modèles de Cox (i.e. semi-paramétriques), par contre, offrent les mêmes possibilités qu’un modèle de régression (e.g. ajustement pour facteurs confondants, prédicteur quantitatif, interaction).</p>
<ol style="list-style-type: decimal">
<li>À l’aide d’un modèle de Cox, évaluer l’effet du groupe de traitement (<em>tx</em>) sur le nombre de jours (<em>dar</em>) jusqu’à la conception (<em>preg</em>) tout en contrôlant les facteurs confondants <em>thin</em>, <em>lact</em> et <em>herd</em>.</li>
</ol>
<p>1.1. Comment interprétez-vous les résultats de ce modèle pour la variable <em>tx</em>?</p>
<p>1.2. Quelles sont les suppositions que vous aurez à vérifier pour ce modèle de Cox?</p>
<p>1.3. Vérifiez que le hasard est bien proportionnel pour la variable <em>tx</em> (i.e. que l’effet de <em>tx</em> ne change pas dans le temps).</p>
<p>1.4. Vérifiez que la linéarité de la relation est bien respectée pour la variable <em>lact</em>.</p>
<ol start="2" style="list-style-type: decimal">
<li>Vos évaluations préliminaires vous ont permis de conclure que l’effet du traitement change dans le temps et que la relation entre <em>lact</em> et H(t) est une courbe. Vous décidez donc du modèle suivant:</li>
</ol>
<p><span class="math inline">\(Ln H(t) = ln H_0(t) + β_1*tx + β_2*tx*time + β_3*(lact-1) + β_4*(lact-1)^2 + β_5*thin + β_6*herd\)</span></p>
<p>Où time est une variable catégorique ≤5 jours <em>vs.</em> &gt;5 jours.</p>
<p>2.1. Comment change le risque de conception dans les 5 jours suivant le traitement lorsque les prostaglandines sont utilisées plutôt qu’un placebo? Et après 5 jours?</p>
<p>2.2. En supposant qu’une vache resterait dans un troupeau jusqu’à 500 jours suivants le traitement avant d’être réformée, évaluez l’effet qu’aurait pu avoir une censure informative.</p>
<p>2.3. Quelles sont les observations avec les résiduels les plus larges? Ont-elles quelque chose en commun?</p>
<p>2.4. Quelles sont les observations les plus influentes sur les coefficients <span class="math inline">\(tx\)</span> et <span class="math inline">\(tx*time\)</span>? Ont-elles quelquechose en commun?</p>
</div>
<div id="code-r-et-réponses-8" class="section level3 hasAnchor" number="9.8.2">
<h3><span class="header-section-number">9.8.2</span> Code R et réponses<a href="analyses-de-survie.html#code-r-et-réponses-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour ce TP utilisez le fichier <em>pgtrial.csv</em> (voir description VER p.824).</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="analyses-de-survie.html#cb431-1" aria-hidden="true" tabindex="-1"></a>pgtrial <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">&quot;pgtrial.csv&quot;</span>, </span>
<span id="cb431-2"><a href="analyses-de-survie.html#cb431-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb431-3"><a href="analyses-de-survie.html#cb431-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sep=</span><span class="st">&quot;;&quot;</span></span>
<span id="cb431-4"><a href="analyses-de-survie.html#cb431-4" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb431-5"><a href="analyses-de-survie.html#cb431-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pgtrial)</span></code></pre></div>
<pre><code>##   herd cow tx lact thin dar preg
## 1    1   1  0    1    0   1    1
## 2    1   2  1    4    1   1    1
## 3    1   3  1    1    0   2    1
## 4    1   4  1    1    0   3    1
## 5    1   5  1    6    0   3    0
## 6    1   6  1    1    0   3    1</code></pre>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="analyses-de-survie.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co">#On indique les variables catégoriques du jeu de données</span></span>
<span id="cb433-2"><a href="analyses-de-survie.html#cb433-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>thin <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>thin) </span>
<span id="cb433-3"><a href="analyses-de-survie.html#cb433-3" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>herd <span class="ot">&lt;-</span> <span class="fu">factor</span>(pgtrial<span class="sc">$</span>herd) </span></code></pre></div>
<p>Cette étude est un essai clinique randomisé sur l’effet de l’administration d’une dose de prostaglandine vs. d’un placebo (<em>tx</em>) au début de la période de reproduction sur le nombre de jours (<em>dar</em>) jusqu’à la conception (<em>preg</em>). L’hypothèse était que l’administration de prostaglandine réduirait le nombre de jours jusqu’à la conception. Les 319 vaches de cette étude étaient suivies jusqu’à un maximum de 346 jours en lait. Trois autres prédicteurs étaient aussi évalués: le nombre de lactations (<em>lact</em>; 1, 2, 3…), l’état de chair (<em>thin</em>; 0=normal, 1=thin) et le troupeau (<em>herd</em>; 3 troupeaux).</p>
<p>Comme vous l’avez vu au dernier TP, les modèles non-paramétriques sont plutôt limités lorsque l’on désire évaluer l’effet de plus d’un prédicteur. Les modèles de Cox (i.e. semi-paramétriques), par contre, offrent les mêmes possibilités qu’un modèle de régression (e.g. ajustement pour facteurs confondants, prédicteur quantitatif, interaction).</p>
<ol style="list-style-type: decimal">
<li>À l’aide d’un modèle de Cox, évaluer l’effet du groupe de traitement (<em>tx</em>) sur le nombre de jours (<em>dar</em>) jusqu’à la conception (<em>preg</em>) tout en contrôlant les facteurs confondants <em>thin</em>, <em>lact</em> et <em>herd</em>.</li>
</ol>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="analyses-de-survie.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb434-2"><a href="analyses-de-survie.html#cb434-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb434-3"><a href="analyses-de-survie.html#cb434-3" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb434-4"><a href="analyses-de-survie.html#cb434-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb434-5"><a href="analyses-de-survie.html#cb434-5" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb434-6"><a href="analyses-de-survie.html#cb434-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(PH_fit_pg)</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-304-1.png" width="672" /></p>
<p>1.1. Comment interprétez-vous les résultats de ce modèle pour la variable <em>tx</em>?<br />
<strong>Réponse:</strong> Le groupe de traitement (<em>tx</em>) n’est pas significativement associé au temps jusqu’à la saillie fécondante (P =0.12). Lorsque <em>thin</em>, <em>lact</em> et <em>herd</em> sont gardés constants, le risque de conception à n’importe quel moment était multiplié par 1.22 (i.e. le Hazard Ratio), mais l’IC 95% (0.95 à 1.6) inclus la valeur nulle (1.0).</p>
<p>1.2. Quelles sont les suppositions que vous aurez à vérifier pour ce modèle de Cox?<br />
<strong>Réponse:</strong><br />
- Pour chacun des prédicteurs (i.e. <em>tx</em>, <em>lact</em>, <em>thin</em> et <em>herd</em>), on devra vérifier que le hasard est proportionnel (i.e. effet ne change pas dans le temps);<br />
- Linéarité de la relation pour <em>lact</em> qui est un prédicteur quantitatif (on pourrait tester un terme au carré, par exemple);<br />
- Censure non-informative;<br />
- Indépendance des observations (i.e. pas de regroupement).</p>
<p>1.3. Vérifiez que le hasard est bien proportionnel pour la variable <em>tx</em> (i.e. que l’effet de <em>tx</em> ne change pas dans le temps).<br />
<strong>Réponse:</strong> On peut s’y prendre de trois manières:<br />
1) graphique de ln H(t) * ln du temps pour chaque niveau du prédicteur;<br />
2) comparer courbes de survie non-paramétrique et semi-paramétrique;<br />
3) ajouter une interaction avec le temps et vérifier si statistiquement significative (i.e. <em>P</em> &lt; 0.05).</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="analyses-de-survie.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb435-2"><a href="analyses-de-survie.html#cb435-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle de K-M avec la variable qui nous intéresse</span></span>
<span id="cb435-3"><a href="analyses-de-survie.html#cb435-3" aria-hidden="true" tabindex="-1"></a>KM_fit_pg <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb435-4"><a href="analyses-de-survie.html#cb435-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx</span>
<span id="cb435-5"><a href="analyses-de-survie.html#cb435-5" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb435-6"><a href="analyses-de-survie.html#cb435-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-7"><a href="analyses-de-survie.html#cb435-7" aria-hidden="true" tabindex="-1"></a><span class="co">#La figure ln(H(t)) par ln(temps)</span></span>
<span id="cb435-8"><a href="analyses-de-survie.html#cb435-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(KM_fit_pg, </span>
<span id="cb435-9"><a href="analyses-de-survie.html#cb435-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb435-10"><a href="analyses-de-survie.html#cb435-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">fun=</span><span class="st">&quot;cloglog&quot;</span>, </span>
<span id="cb435-11"><a href="analyses-de-survie.html#cb435-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;days&quot;</span>, </span>
<span id="cb435-12"><a href="analyses-de-survie.html#cb435-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Log(H(t))&quot;</span></span>
<span id="cb435-13"><a href="analyses-de-survie.html#cb435-13" aria-hidden="true" tabindex="-1"></a>     )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-305"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-305-1.png" alt="Graphique du log du hasard cumulatif (ln H(t)) par le log du temps (ln(t))." width="672" />
<p class="caption">
Figure 9.14: Graphique du log du hasard cumulatif (ln H(t)) par le log du temps (ln(t)).
</p>
</div>
<p><strong>Réponse:</strong> Dans ce cas, le fait que les courbes ne sont pas parallèles indique que le hasard n’est pas proportionnel dans le temps.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="analyses-de-survie.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb436-2"><a href="analyses-de-survie.html#cb436-2" aria-hidden="true" tabindex="-1"></a><span class="co">#La courbe de survie de Kaplan-Meier</span></span>
<span id="cb436-3"><a href="analyses-de-survie.html#cb436-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(KM_fit_pg)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-306"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-306-1.png" alt="Courbes de survie de Kaplan-Meier pour la variable traitement." width="672" />
<p class="caption">
Figure 9.15: Courbes de survie de Kaplan-Meier pour la variable traitement.
</p>
</div>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="analyses-de-survie.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle de cox équivalent</span></span>
<span id="cb437-2"><a href="analyses-de-survie.html#cb437-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb437-3"><a href="analyses-de-survie.html#cb437-3" aria-hidden="true" tabindex="-1"></a>PH_fit_pg <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb437-4"><a href="analyses-de-survie.html#cb437-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx</span>
<span id="cb437-5"><a href="analyses-de-survie.html#cb437-5" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb437-6"><a href="analyses-de-survie.html#cb437-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-7"><a href="analyses-de-survie.html#cb437-7" aria-hidden="true" tabindex="-1"></a><span class="co">#La courbe de survie de Cox</span></span>
<span id="cb437-8"><a href="analyses-de-survie.html#cb437-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggadjustedcurves</span>(PH_fit_pg, </span>
<span id="cb437-9"><a href="analyses-de-survie.html#cb437-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">variable=</span><span class="st">&quot;tx&quot;</span></span>
<span id="cb437-10"><a href="analyses-de-survie.html#cb437-10" aria-hidden="true" tabindex="-1"></a>                 )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-307"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-307-1.png" alt="Courbes de survie de Cox pour la variable traitement." width="672" />
<p class="caption">
Figure 9.16: Courbes de survie de Cox pour la variable traitement.
</p>
</div>
<p><strong>Réponse:</strong> La courbe de survie de Cox donne un résultat similaire: les courbes de Cox et de Kaplan-Meier sont passablement différentes (surtout avant 50 jours), cela indique que le hasard n’est pas proportionnel dans le temps.</p>
<p>Finalement, on pourrait aussi tester une interaction entre <em>tx</em> et le temps. Par exemple:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="analyses-de-survie.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Créer la variable temps</span></span>
<span id="cb438-2"><a href="analyses-de-survie.html#cb438-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>t_cat <span class="ot">&lt;-</span> <span class="fu">cut</span>(pgtrial<span class="sc">$</span>dar, </span>
<span id="cb438-3"><a href="analyses-de-survie.html#cb438-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">26</span>, <span class="cn">Inf</span>),</span>
<span id="cb438-4"><a href="analyses-de-survie.html#cb438-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0-5 days&quot;</span>, <span class="st">&quot;5-26 days&quot;</span>, <span class="st">&quot;&gt;26 days&quot;</span>)</span>
<span id="cb438-5"><a href="analyses-de-survie.html#cb438-5" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb438-6"><a href="analyses-de-survie.html#cb438-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-7"><a href="analyses-de-survie.html#cb438-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle de Cox avec l&#39;interaction</span></span>
<span id="cb438-8"><a href="analyses-de-survie.html#cb438-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb438-9"><a href="analyses-de-survie.html#cb438-9" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_t_cat <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb438-10"><a href="analyses-de-survie.html#cb438-10" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx <span class="sc">+</span> tx<span class="sc">*</span>t_cat <span class="sc">-</span> t_cat</span>
<span id="cb438-11"><a href="analyses-de-survie.html#cb438-11" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb438-12"><a href="analyses-de-survie.html#cb438-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PH_fit_pg_t_cat)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(dar, preg) ~ tx + tx * t_cat - t_cat, data = pgtrial)
## 
##   n= 319, number of events= 264 
## 
##                         coef  exp(coef)   se(coef)      z     Pr(&gt;|z|)    
## tx                  5.696984 297.967370   0.597725  9.531      &lt; 2e-16 ***
## tx:t_cat5-26 days  -3.485914   0.030626   0.650500 -5.359 0.0000000838 ***
## tx:t_cat&gt;26 days   -5.985539   0.002515   0.603662 -9.915      &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                    exp(coef) exp(-coef)  lower .95 upper .95
## tx                297.967370   0.003356 92.3388206 961.50842
## tx:t_cat5-26 days   0.030626  32.652272  0.0085582   0.10960
## tx:t_cat&gt;26 days    0.002515 397.636926  0.0007703   0.00821
## 
## Concordance= 0.681  (se = 0.018 )
## Likelihood ratio test= 219.6  on 3 df,   p=&lt;2e-16
## Wald test            = 121  on 3 df,   p=&lt;2e-16
## Score (logrank) test = 485.2  on 3 df,   p=&lt;2e-16</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="analyses-de-survie.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nous pourrions faire un test de rapport de vraisemblance pour comparer les modèles avec et sans l&#39;interaction</span></span>
<span id="cb440-2"><a href="analyses-de-survie.html#cb440-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb440-3"><a href="analyses-de-survie.html#cb440-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(PH_fit_pg_t_cat, </span>
<span id="cb440-4"><a href="analyses-de-survie.html#cb440-4" aria-hidden="true" tabindex="-1"></a>       PH_fit_pg</span>
<span id="cb440-5"><a href="analyses-de-survie.html#cb440-5" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: Surv(dar, preg) ~ tx + tx * t_cat - t_cat
## Model 2: Surv(dar, preg) ~ tx
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   3 -1200.1                         
## 2   1 -1309.0 -2 217.78  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>Réponse:</strong> Notez que vous pouvez « traiter » la variable temps comme bon vous le désirez en fonction de ce que vous connaissez de la biologie. Ici, j’ai catégorisé le temps (<em>t_cat</em>) de cette manière : &lt;5 jours vs. 5-26 jours vs. &gt;26 jours. Mon test de rapport de vraisemblance me donne une valeur de <em>P</em> &lt; 0.001 pour le groupe de variables indicatrices <span class="math inline">\(tx*tcat\)</span>. Cela indique donc que l’effet du traitement (<em>tx</em>) sur le risque de conception n’est pas le même dans les 5 jours suivant le traitement <em>vs.</em> les jours 5 à 26 <em>vs.</em> après 26 jours . i.e. les hasards ne sont pas proportionnels. Afin de mieux illustrer ces différences j’ai réorganisé mes résultats dans la table suivante.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="analyses-de-survie.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb442-2"><a href="analyses-de-survie.html#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère d&#39;abord l&#39;objet contrast à partir du modèle</span></span>
<span id="cb442-3"><a href="analyses-de-survie.html#cb442-3" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(PH_fit_pg_t_cat, </span>
<span id="cb442-4"><a href="analyses-de-survie.html#cb442-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(<span class="st">&quot;tx&quot;</span>, <span class="st">&quot;t_cat&quot;</span>)</span>
<span id="cb442-5"><a href="analyses-de-survie.html#cb442-5" aria-hidden="true" tabindex="-1"></a>                    ) </span>
<span id="cb442-6"><a href="analyses-de-survie.html#cb442-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-7"><a href="analyses-de-survie.html#cb442-7" aria-hidden="true" tabindex="-1"></a><span class="co">#On demande les comparaisons pairées, nous voulions voir Tx=1 vs Tx=0, nous avons donc dû utiliser reverse=TRUE. Puis on a ajouté les IC95 avec confint</span></span>
<span id="cb442-8"><a href="analyses-de-survie.html#cb442-8" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">confint</span>(<span class="fu">pairs</span>(contrast, </span>
<span id="cb442-9"><a href="analyses-de-survie.html#cb442-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">reverse =</span> <span class="cn">TRUE</span></span>
<span id="cb442-10"><a href="analyses-de-survie.html#cb442-10" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb442-11"><a href="analyses-de-survie.html#cb442-11" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb442-12"><a href="analyses-de-survie.html#cb442-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-13"><a href="analyses-de-survie.html#cb442-13" aria-hidden="true" tabindex="-1"></a><span class="co">#On retravaille les résultats pour la présentation. D&#39;abord en les mettant à l&#39;exposant pour avoir des HR, puis en arrondissant.</span></span>
<span id="cb442-14"><a href="analyses-de-survie.html#cb442-14" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>HR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>estimate), </span>
<span id="cb442-15"><a href="analyses-de-survie.html#cb442-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb442-16"><a href="analyses-de-survie.html#cb442-16" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb442-17"><a href="analyses-de-survie.html#cb442-17" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>lowCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>asymp.LCL), </span>
<span id="cb442-18"><a href="analyses-de-survie.html#cb442-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb442-19"><a href="analyses-de-survie.html#cb442-19" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb442-20"><a href="analyses-de-survie.html#cb442-20" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>hiCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>asymp.UCL), </span>
<span id="cb442-21"><a href="analyses-de-survie.html#cb442-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb442-22"><a href="analyses-de-survie.html#cb442-22" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb442-23"><a href="analyses-de-survie.html#cb442-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-24"><a href="analyses-de-survie.html#cb442-24" aria-hidden="true" tabindex="-1"></a><span class="co">#On ne conserve que les rangées (4, 8 et 13) et les colonnes (1, 7, 8, 9) qui nous intéressent</span></span>
<span id="cb442-25"><a href="analyses-de-survie.html#cb442-25" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> result[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">13</span>),<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)]</span>
<span id="cb442-26"><a href="analyses-de-survie.html#cb442-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-27"><a href="analyses-de-survie.html#cb442-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb442-28"><a href="analyses-de-survie.html#cb442-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb442-29"><a href="analyses-de-survie.html#cb442-29" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (result2, </span>
<span id="cb442-30"><a href="analyses-de-survie.html#cb442-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;HR et IC95 d&#39;un traitement à la prostaglandine sur le risque de conception en fonction du nombre de jours suivant le traitement.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb442-31"><a href="analyses-de-survie.html#cb442-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-309">Table 9.4: </span>HR et IC95 d’un traitement à la prostaglandine sur le risque de conception en fonction du nombre de jours suivant le traitement.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
contrast
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:right;">
lowCI
</th>
<th style="text-align:right;">
hiCI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
(0-5 days tx1) - (0-5 days tx0)
</td>
<td style="text-align:right;">
297.97
</td>
<td style="text-align:right;">
54.25
</td>
<td style="text-align:right;">
1636.51
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
(5-26 days tx1) - (5-26 days tx0)
</td>
<td style="text-align:right;">
9.13
</td>
<td style="text-align:right;">
3.14
</td>
<td style="text-align:right;">
26.53
</td>
</tr>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
&gt;26 days tx1 - &gt;26 days tx0
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
1.12
</td>
</tr>
</tbody>
</table>
<p><strong>Réponse:</strong> L’injection de prostaglandines a donc un effet important sur le hasard de conception dans les 5 jours suivant l’injection (HR: 297.97; <em>IC95</em>: 54.25, 1636.51), puis cet effet est maintenu, mais moindre entre 5-26 jours (HR: 9.13; <em>IC95</em>: 3.14, 26.53) et, finalement, il n’y a plus d’effet après 26 jours (HR: 0.75; <em>IC95</em>: 0.50, 1.12).</p>
<p>1.4. Vérifiez que la linéarité de la relation est bien respectée pour la variable <em>lact</em>.<br />
<strong>Réponse:</strong> On peut s’y prendre de 2 manières:<br />
1) ajout de termes polynomiaux;<br />
2) graphiques résiduels de Martingdale (d’un modèle sans le prédicteur <em>lact</em>) par la variable <em>lact</em>.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="analyses-de-survie.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Créer les termes polynomiaux</span></span>
<span id="cb443-2"><a href="analyses-de-survie.html#cb443-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct <span class="ot">&lt;-</span> pgtrial<span class="sc">$</span>lact<span class="dv">-1</span></span>
<span id="cb443-3"><a href="analyses-de-survie.html#cb443-3" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct_sq <span class="ot">&lt;-</span> (pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)<span class="sc">*</span>(pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)</span>
<span id="cb443-4"><a href="analyses-de-survie.html#cb443-4" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct_cu <span class="ot">&lt;-</span> (pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)<span class="sc">*</span>(pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)<span class="sc">*</span>(pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)</span>
<span id="cb443-5"><a href="analyses-de-survie.html#cb443-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-6"><a href="analyses-de-survie.html#cb443-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle avec le terme au carré</span></span>
<span id="cb443-7"><a href="analyses-de-survie.html#cb443-7" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_sq <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb443-8"><a href="analyses-de-survie.html#cb443-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact_ct <span class="sc">+</span> lact_ct_sq <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb443-9"><a href="analyses-de-survie.html#cb443-9" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb443-10"><a href="analyses-de-survie.html#cb443-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb443-11"><a href="analyses-de-survie.html#cb443-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(PH_fit_pg_sq)</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-310-1.png" width="672" /></p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="analyses-de-survie.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle avec le terme au carré et celui au cube</span></span>
<span id="cb444-2"><a href="analyses-de-survie.html#cb444-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_cu <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb444-3"><a href="analyses-de-survie.html#cb444-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span> tx <span class="sc">+</span> lact_ct <span class="sc">+</span> lact_ct_sq <span class="sc">+</span>lact_ct_cu <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb444-4"><a href="analyses-de-survie.html#cb444-4" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb444-5"><a href="analyses-de-survie.html#cb444-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(PH_fit_pg_cu)</span></code></pre></div>
<p><img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-310-2.png" width="672" /></p>
<p>Avec les termes polynomiaux: <em>lact</em> au carré est significatif (<em>P</em> = 0.03), cela indique donc une relation curvilinéaire. <em>lact</em> au cube n’est pas significatif (<em>P</em>=0.51), l’ajout de points d’inflexion n’est donc pas nécessaire. Nous pourrions donc utiliser <span class="math inline">\(lact\)</span> et <span class="math inline">\(lact^2\)</span> afin de correctement modéliser la relation entre lactation et temps jusqu’à la conception.</p>
<p>Avec le graphique des résiduels de Martingdale par la variable <em>lact</em> on observera encore cette relation curvilinéaire:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="analyses-de-survie.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Faire rouler le modèle sans le prédicteur continu lact</span></span>
<span id="cb445-2"><a href="analyses-de-survie.html#cb445-2" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_WO_lact <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb445-3"><a href="analyses-de-survie.html#cb445-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb445-4"><a href="analyses-de-survie.html#cb445-4" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb445-5"><a href="analyses-de-survie.html#cb445-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-6"><a href="analyses-de-survie.html#cb445-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajouter les résiduels de Martingale dans le jeu de données</span></span>
<span id="cb445-7"><a href="analyses-de-survie.html#cb445-7" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">resid</span>(PH_fit_pg_WO_lact) </span>
<span id="cb445-8"><a href="analyses-de-survie.html#cb445-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-9"><a href="analyses-de-survie.html#cb445-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb445-10"><a href="analyses-de-survie.html#cb445-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pgtrial, </span>
<span id="cb445-11"><a href="analyses-de-survie.html#cb445-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>lact, </span>
<span id="cb445-12"><a href="analyses-de-survie.html#cb445-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>res</span>
<span id="cb445-13"><a href="analyses-de-survie.html#cb445-13" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb445-14"><a href="analyses-de-survie.html#cb445-14" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb445-15"><a href="analyses-de-survie.html#cb445-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co">#On demande d&#39;ajouter le nuage de points (un &#39;scatterplot&#39;)</span></span>
<span id="cb445-16"><a href="analyses-de-survie.html#cb445-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;loess&quot;</span>, </span>
<span id="cb445-17"><a href="analyses-de-survie.html#cb445-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">span=</span><span class="dv">2</span></span>
<span id="cb445-18"><a href="analyses-de-survie.html#cb445-18" aria-hidden="true" tabindex="-1"></a>              )<span class="sc">+</span> <span class="co">#On demande d&#39;ajouter la courbe lissée de type loess. </span></span>
<span id="cb445-19"><a href="analyses-de-survie.html#cb445-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-311"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-311-1.png" alt="Graphique des résiduels de Martingdale en fonction de la parité." width="672" />
<p class="caption">
Figure 9.17: Graphique des résiduels de Martingdale en fonction de la parité.
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Vos évaluations préliminaires vous ont permis de conclure que l’effet du traitement change dans le temps et que la relation entre <em>lact</em> et H(t) est une courbe. Vous décidez donc du modèle suivant:</li>
</ol>
<p><span class="math inline">\(Ln H(t) = ln H_0(t) + β_1*tx + β_2*tx*time + β_3*(lact-1) + β_4*(lact-1)^2 + β_5*thin + β_6*herd\)</span></p>
<p>Où time est une variable catégorique ≤5 jours <em>vs.</em> &gt;5 jours.</p>
<p>2.1. Comment change le risque de conception dans les 5 jours suivant le traitement lorsque les prostaglandines sont utilisées plutôt qu’un placebo? Et après 5 jours?</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="analyses-de-survie.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Créer la variable temps</span></span>
<span id="cb446-2"><a href="analyses-de-survie.html#cb446-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>t5 <span class="ot">&lt;-</span> <span class="fu">cut</span>(pgtrial<span class="sc">$</span>dar, </span>
<span id="cb446-3"><a href="analyses-de-survie.html#cb446-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="cn">Inf</span>),</span>
<span id="cb446-4"><a href="analyses-de-survie.html#cb446-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0-5 days&quot;</span>,  <span class="st">&quot;&gt;5 days&quot;</span>)</span>
<span id="cb446-5"><a href="analyses-de-survie.html#cb446-5" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb446-6"><a href="analyses-de-survie.html#cb446-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-7"><a href="analyses-de-survie.html#cb446-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Créer les variables lact centrées et au carré</span></span>
<span id="cb446-8"><a href="analyses-de-survie.html#cb446-8" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct <span class="ot">&lt;-</span> pgtrial<span class="sc">$</span>lact<span class="dv">-1</span></span>
<span id="cb446-9"><a href="analyses-de-survie.html#cb446-9" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>lact_ct_sq <span class="ot">&lt;-</span> (pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)<span class="sc">*</span>(pgtrial<span class="sc">$</span>lact<span class="dv">-1</span>)</span>
<span id="cb446-10"><a href="analyses-de-survie.html#cb446-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-11"><a href="analyses-de-survie.html#cb446-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Le modèle de Cox</span></span>
<span id="cb446-12"><a href="analyses-de-survie.html#cb446-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb446-13"><a href="analyses-de-survie.html#cb446-13" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_final <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb446-14"><a href="analyses-de-survie.html#cb446-14" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">Surv</span>(dar, preg) <span class="sc">~</span>  tx<span class="sc">*</span>t5 <span class="sc">-</span> t5 <span class="sc">+</span> lact_ct <span class="sc">+</span> lact_ct_sq <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb446-15"><a href="analyses-de-survie.html#cb446-15" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb446-16"><a href="analyses-de-survie.html#cb446-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-17"><a href="analyses-de-survie.html#cb446-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb446-18"><a href="analyses-de-survie.html#cb446-18" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère ensuite l&#39;objet contrast à partir du modèle</span></span>
<span id="cb446-19"><a href="analyses-de-survie.html#cb446-19" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(PH_fit_pg_final, </span>
<span id="cb446-20"><a href="analyses-de-survie.html#cb446-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(<span class="st">&quot;tx&quot;</span>, <span class="st">&quot;t5&quot;</span>)</span>
<span id="cb446-21"><a href="analyses-de-survie.html#cb446-21" aria-hidden="true" tabindex="-1"></a>                    ) </span>
<span id="cb446-22"><a href="analyses-de-survie.html#cb446-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-23"><a href="analyses-de-survie.html#cb446-23" aria-hidden="true" tabindex="-1"></a><span class="co">#On demande les comparaisons pairées, nous voulons voir Tx=1 vs Tx=0, nous avons donc dû utiliser reverse=TRUE. Puis on a ajouté les IC95 avec confint</span></span>
<span id="cb446-24"><a href="analyses-de-survie.html#cb446-24" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">confint</span>(<span class="fu">pairs</span>(contrast, </span>
<span id="cb446-25"><a href="analyses-de-survie.html#cb446-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">reverse =</span> <span class="cn">TRUE</span></span>
<span id="cb446-26"><a href="analyses-de-survie.html#cb446-26" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb446-27"><a href="analyses-de-survie.html#cb446-27" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb446-28"><a href="analyses-de-survie.html#cb446-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-29"><a href="analyses-de-survie.html#cb446-29" aria-hidden="true" tabindex="-1"></a><span class="co">#On retravaille les résultats pour la présentation. D&#39;abord en les mettant à l&#39;exposant pour avoir des HR, puis en arrondissant.</span></span>
<span id="cb446-30"><a href="analyses-de-survie.html#cb446-30" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>HR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>estimate), </span>
<span id="cb446-31"><a href="analyses-de-survie.html#cb446-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb446-32"><a href="analyses-de-survie.html#cb446-32" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb446-33"><a href="analyses-de-survie.html#cb446-33" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>lowCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>asymp.LCL), </span>
<span id="cb446-34"><a href="analyses-de-survie.html#cb446-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb446-35"><a href="analyses-de-survie.html#cb446-35" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb446-36"><a href="analyses-de-survie.html#cb446-36" aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>hiCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result<span class="sc">$</span>asymp.UCL),</span>
<span id="cb446-37"><a href="analyses-de-survie.html#cb446-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb446-38"><a href="analyses-de-survie.html#cb446-38" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb446-39"><a href="analyses-de-survie.html#cb446-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-40"><a href="analyses-de-survie.html#cb446-40" aria-hidden="true" tabindex="-1"></a><span class="co">#On ne conserve que les rangées (2 et 5) et les colonnes (1, 7, 8, 9) qui nous intéressent</span></span>
<span id="cb446-41"><a href="analyses-de-survie.html#cb446-41" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> result[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>),<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)]</span>
<span id="cb446-42"><a href="analyses-de-survie.html#cb446-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-43"><a href="analyses-de-survie.html#cb446-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb446-44"><a href="analyses-de-survie.html#cb446-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb446-45"><a href="analyses-de-survie.html#cb446-45" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (result2, </span>
<span id="cb446-46"><a href="analyses-de-survie.html#cb446-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;HR et IC95 d&#39;un traitement à la prostaglandine sur le risque de conception en fonction du nombre de jours suivant le traitement.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb446-47"><a href="analyses-de-survie.html#cb446-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-312">Table 9.5: </span>HR et IC95 d’un traitement à la prostaglandine sur le risque de conception en fonction du nombre de jours suivant le traitement.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
contrast
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:right;">
lowCI
</th>
<th style="text-align:right;">
hiCI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
(0-5 days tx1) - (0-5 days tx0)
</td>
<td style="text-align:right;">
226.96
</td>
<td style="text-align:right;">
49.77
</td>
<td style="text-align:right;">
1035.09
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
&gt;5 days tx1 - &gt;5 days tx0
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
1.20
</td>
</tr>
</tbody>
</table>
<p>2.2. En supposant qu’une vache resterait dans un troupeau jusqu’à 500 jours suivants le traitement avant d’être réformée, évaluez l’effet qu’aurait pu avoir une censure informative.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="analyses-de-survie.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co">#On doit d&#39;abord créer une nouvelle variable DAR qui prendrait la valeur 500 pour les vaches censurées</span></span>
<span id="cb447-2"><a href="analyses-de-survie.html#cb447-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>dar2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pgtrial<span class="sc">$</span>preg<span class="sc">==</span><span class="dv">1</span>, </span>
<span id="cb447-3"><a href="analyses-de-survie.html#cb447-3" aria-hidden="true" tabindex="-1"></a>                       pgtrial<span class="sc">$</span>dar, </span>
<span id="cb447-4"><a href="analyses-de-survie.html#cb447-4" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">500</span></span>
<span id="cb447-5"><a href="analyses-de-survie.html#cb447-5" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb447-6"><a href="analyses-de-survie.html#cb447-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Et une variable alternative preg où toutes les vaches sont gestantes à la fin</span></span>
<span id="cb447-7"><a href="analyses-de-survie.html#cb447-7" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>preg2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb447-8"><a href="analyses-de-survie.html#cb447-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-9"><a href="analyses-de-survie.html#cb447-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensuite, on peut faire 2 modèles de Cox en utilisant une ou l&#39;autre de ces nouvelles variables</span></span>
<span id="cb447-10"><a href="analyses-de-survie.html#cb447-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb447-11"><a href="analyses-de-survie.html#cb447-11" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_cens_info_n <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb447-12"><a href="analyses-de-survie.html#cb447-12" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">Surv</span>(dar2, preg) <span class="sc">~</span>  tx<span class="sc">*</span>t5 <span class="sc">-</span> t5 <span class="sc">+</span> lact_ct <span class="sc">+</span> lact_ct_sq <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb447-13"><a href="analyses-de-survie.html#cb447-13" aria-hidden="true" tabindex="-1"></a>                               )</span>
<span id="cb447-14"><a href="analyses-de-survie.html#cb447-14" aria-hidden="true" tabindex="-1"></a>PH_fit_pg_cens_info_p <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">data=</span>pgtrial,</span>
<span id="cb447-15"><a href="analyses-de-survie.html#cb447-15" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">Surv</span>(dar2, preg2) <span class="sc">~</span>  tx<span class="sc">*</span>t5 <span class="sc">-</span> t5 <span class="sc">+</span> lact_ct <span class="sc">+</span> lact_ct_sq <span class="sc">+</span> thin <span class="sc">+</span> herd</span>
<span id="cb447-16"><a href="analyses-de-survie.html#cb447-16" aria-hidden="true" tabindex="-1"></a>                               )</span></code></pre></div>
<p>Si on voulait plus particulièrement visualiser les effets pour le <em>tx</em> (et son interaction):</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="analyses-de-survie.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb448-2"><a href="analyses-de-survie.html#cb448-2" aria-hidden="true" tabindex="-1"></a><span class="co">#On génère d&#39;abord l&#39;objet contrast à partir du modèle</span></span>
<span id="cb448-3"><a href="analyses-de-survie.html#cb448-3" aria-hidden="true" tabindex="-1"></a>contrast_final <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(PH_fit_pg_final, </span>
<span id="cb448-4"><a href="analyses-de-survie.html#cb448-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="st">&quot;tx&quot;</span>, <span class="st">&quot;t5&quot;</span>)</span>
<span id="cb448-5"><a href="analyses-de-survie.html#cb448-5" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb448-6"><a href="analyses-de-survie.html#cb448-6" aria-hidden="true" tabindex="-1"></a>contrast_censp <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(PH_fit_pg_cens_info_n, </span>
<span id="cb448-7"><a href="analyses-de-survie.html#cb448-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="st">&quot;tx&quot;</span>, <span class="st">&quot;t5&quot;</span>)</span>
<span id="cb448-8"><a href="analyses-de-survie.html#cb448-8" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb448-9"><a href="analyses-de-survie.html#cb448-9" aria-hidden="true" tabindex="-1"></a>contrast_censn <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(PH_fit_pg_cens_info_p, </span>
<span id="cb448-10"><a href="analyses-de-survie.html#cb448-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="st">&quot;tx&quot;</span>, <span class="st">&quot;t5&quot;</span>)</span>
<span id="cb448-11"><a href="analyses-de-survie.html#cb448-11" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb448-12"><a href="analyses-de-survie.html#cb448-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-13"><a href="analyses-de-survie.html#cb448-13" aria-hidden="true" tabindex="-1"></a><span class="co">#On demande les comparaisons pairées, on voulait voir Tx=1 vs Tx=0, nous avons donc dû utiliser reverse=TRUE. Puis nous avons ajouté les IC95 avec confint</span></span>
<span id="cb448-14"><a href="analyses-de-survie.html#cb448-14" aria-hidden="true" tabindex="-1"></a>result_final <span class="ot">&lt;-</span> <span class="fu">confint</span>(<span class="fu">pairs</span>(contrast_final, </span>
<span id="cb448-15"><a href="analyses-de-survie.html#cb448-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb448-16"><a href="analyses-de-survie.html#cb448-16" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb448-17"><a href="analyses-de-survie.html#cb448-17" aria-hidden="true" tabindex="-1"></a>result_censn <span class="ot">&lt;-</span> <span class="fu">confint</span>(<span class="fu">pairs</span>(contrast_censn, </span>
<span id="cb448-18"><a href="analyses-de-survie.html#cb448-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb448-19"><a href="analyses-de-survie.html#cb448-19" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb448-20"><a href="analyses-de-survie.html#cb448-20" aria-hidden="true" tabindex="-1"></a>result_censp <span class="ot">&lt;-</span> <span class="fu">confint</span>(<span class="fu">pairs</span>(contrast_censp, </span>
<span id="cb448-21"><a href="analyses-de-survie.html#cb448-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb448-22"><a href="analyses-de-survie.html#cb448-22" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb448-23"><a href="analyses-de-survie.html#cb448-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-24"><a href="analyses-de-survie.html#cb448-24" aria-hidden="true" tabindex="-1"></a><span class="co">#On retravaille les résultats pour la présentation. D&#39;abord en les mettant à l&#39;exposant pour avoir des HR, puis en arrondissant.</span></span>
<span id="cb448-25"><a href="analyses-de-survie.html#cb448-25" aria-hidden="true" tabindex="-1"></a>result_final<span class="sc">$</span>HR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_final<span class="sc">$</span>estimate), </span>
<span id="cb448-26"><a href="analyses-de-survie.html#cb448-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-27"><a href="analyses-de-survie.html#cb448-27" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb448-28"><a href="analyses-de-survie.html#cb448-28" aria-hidden="true" tabindex="-1"></a>result_final<span class="sc">$</span>lowCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_final<span class="sc">$</span>asymp.LCL), </span>
<span id="cb448-29"><a href="analyses-de-survie.html#cb448-29" aria-hidden="true" tabindex="-1"></a>                            <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-30"><a href="analyses-de-survie.html#cb448-30" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb448-31"><a href="analyses-de-survie.html#cb448-31" aria-hidden="true" tabindex="-1"></a>result_final<span class="sc">$</span>hiCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_final<span class="sc">$</span>asymp.UCL), </span>
<span id="cb448-32"><a href="analyses-de-survie.html#cb448-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-33"><a href="analyses-de-survie.html#cb448-33" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb448-34"><a href="analyses-de-survie.html#cb448-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-35"><a href="analyses-de-survie.html#cb448-35" aria-hidden="true" tabindex="-1"></a>result_censn<span class="sc">$</span>HR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_censn<span class="sc">$</span>estimate), </span>
<span id="cb448-36"><a href="analyses-de-survie.html#cb448-36" aria-hidden="true" tabindex="-1"></a>                         <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-37"><a href="analyses-de-survie.html#cb448-37" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb448-38"><a href="analyses-de-survie.html#cb448-38" aria-hidden="true" tabindex="-1"></a>result_censn<span class="sc">$</span>lowCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_censn<span class="sc">$</span>asymp.LCL), </span>
<span id="cb448-39"><a href="analyses-de-survie.html#cb448-39" aria-hidden="true" tabindex="-1"></a>                            <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-40"><a href="analyses-de-survie.html#cb448-40" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb448-41"><a href="analyses-de-survie.html#cb448-41" aria-hidden="true" tabindex="-1"></a>result_censn<span class="sc">$</span>hiCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_censn<span class="sc">$</span>asymp.UCL), </span>
<span id="cb448-42"><a href="analyses-de-survie.html#cb448-42" aria-hidden="true" tabindex="-1"></a>                           <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-43"><a href="analyses-de-survie.html#cb448-43" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb448-44"><a href="analyses-de-survie.html#cb448-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-45"><a href="analyses-de-survie.html#cb448-45" aria-hidden="true" tabindex="-1"></a>result_censp<span class="sc">$</span>HR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_censp<span class="sc">$</span>estimate), </span>
<span id="cb448-46"><a href="analyses-de-survie.html#cb448-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-47"><a href="analyses-de-survie.html#cb448-47" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb448-48"><a href="analyses-de-survie.html#cb448-48" aria-hidden="true" tabindex="-1"></a>result_censp<span class="sc">$</span>lowCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_censp<span class="sc">$</span>asymp.LCL),</span>
<span id="cb448-49"><a href="analyses-de-survie.html#cb448-49" aria-hidden="true" tabindex="-1"></a>                            <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-50"><a href="analyses-de-survie.html#cb448-50" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb448-51"><a href="analyses-de-survie.html#cb448-51" aria-hidden="true" tabindex="-1"></a>result_censp<span class="sc">$</span>hiCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(result_censp<span class="sc">$</span>asymp.UCL), </span>
<span id="cb448-52"><a href="analyses-de-survie.html#cb448-52" aria-hidden="true" tabindex="-1"></a>                           <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb448-53"><a href="analyses-de-survie.html#cb448-53" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb448-54"><a href="analyses-de-survie.html#cb448-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-55"><a href="analyses-de-survie.html#cb448-55" aria-hidden="true" tabindex="-1"></a><span class="co">#On ne conserve que les rangées (2 et 5) et les colonnes (1, 7, 8, 9) qui nous intéressent</span></span>
<span id="cb448-56"><a href="analyses-de-survie.html#cb448-56" aria-hidden="true" tabindex="-1"></a>result_fin2 <span class="ot">&lt;-</span> result_final[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>),<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)]</span>
<span id="cb448-57"><a href="analyses-de-survie.html#cb448-57" aria-hidden="true" tabindex="-1"></a>result_censn2 <span class="ot">&lt;-</span> result_censn[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>),<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)]</span>
<span id="cb448-58"><a href="analyses-de-survie.html#cb448-58" aria-hidden="true" tabindex="-1"></a>result_censp2 <span class="ot">&lt;-</span> result_censp[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>),<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)]</span>
<span id="cb448-59"><a href="analyses-de-survie.html#cb448-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-60"><a href="analyses-de-survie.html#cb448-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb448-61"><a href="analyses-de-survie.html#cb448-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb448-62"><a href="analyses-de-survie.html#cb448-62" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (result_fin2, </span>
<span id="cb448-63"><a href="analyses-de-survie.html#cb448-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Modèle final.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb448-64"><a href="analyses-de-survie.html#cb448-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-314">Table 9.6: </span>Modèle final.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
contrast
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:right;">
lowCI
</th>
<th style="text-align:right;">
hiCI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
(0-5 days tx1) - (0-5 days tx0)
</td>
<td style="text-align:right;">
226.96
</td>
<td style="text-align:right;">
49.77
</td>
<td style="text-align:right;">
1035.09
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
&gt;5 days tx1 - &gt;5 days tx0
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
1.20
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="analyses-de-survie.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (result_censn2, </span>
<span id="cb449-2"><a href="analyses-de-survie.html#cb449-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Modèle avec vaches censurées qui survivent jusqu&#39;à 500 jours.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb449-3"><a href="analyses-de-survie.html#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-314">Table 9.6: </span>Modèle avec vaches censurées qui survivent jusqu’à 500 jours.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
contrast
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:right;">
lowCI
</th>
<th style="text-align:right;">
hiCI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
(0-5 days tx1) - (0-5 days tx0)
</td>
<td style="text-align:right;">
5.69
</td>
<td style="text-align:right;">
3.48
</td>
<td style="text-align:right;">
9.32
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
&gt;5 days tx1 - &gt;5 days tx0
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
1.16
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="analyses-de-survie.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (result_censp2, </span>
<span id="cb450-2"><a href="analyses-de-survie.html#cb450-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Modèle avec vaches censurées qui deviennent gestantes au moment de la censure.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb450-3"><a href="analyses-de-survie.html#cb450-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-314">Table 9.6: </span>Modèle avec vaches censurées qui deviennent gestantes au moment de la censure.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
contrast
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:right;">
lowCI
</th>
<th style="text-align:right;">
hiCI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
(0-5 days tx1) - (0-5 days tx0)
</td>
<td style="text-align:right;">
7.60
</td>
<td style="text-align:right;">
4.52
</td>
<td style="text-align:right;">
12.78
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
&gt;5 days tx1 - &gt;5 days tx0
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
1.15
</td>
</tr>
</tbody>
</table>
<p>On voit que les conclusions restent les mêmes (effet du <em>tx</em> entre 0-5 jours, mais pas d’effet &gt; 5 jours). Par contre, l’effet serait moindre (HR de 6 à 7 <em>vs.</em> HR de 226) si la censure était informative.</p>
<p>2.3. Quelles sont les observations avec les résiduels les plus larges? Ont-elles quelque chose en commun?</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="analyses-de-survie.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nous pouvons ajouter les résiduels de déviance à la table</span></span>
<span id="cb451-2"><a href="analyses-de-survie.html#cb451-2" aria-hidden="true" tabindex="-1"></a>pgtrial<span class="sc">$</span>resid_dev <span class="ot">&lt;-</span> <span class="fu">resid</span>(PH_fit_pg_final, </span>
<span id="cb451-3"><a href="analyses-de-survie.html#cb451-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">type=</span><span class="st">&quot;deviance&quot;</span></span>
<span id="cb451-4"><a href="analyses-de-survie.html#cb451-4" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb451-5"><a href="analyses-de-survie.html#cb451-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-6"><a href="analyses-de-survie.html#cb451-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb451-7"><a href="analyses-de-survie.html#cb451-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb451-8"><a href="analyses-de-survie.html#cb451-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pgtrial, </span>
<span id="cb451-9"><a href="analyses-de-survie.html#cb451-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dar, </span>
<span id="cb451-10"><a href="analyses-de-survie.html#cb451-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>resid_dev</span>
<span id="cb451-11"><a href="analyses-de-survie.html#cb451-11" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb451-12"><a href="analyses-de-survie.html#cb451-12" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb451-13"><a href="analyses-de-survie.html#cb451-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb451-14"><a href="analyses-de-survie.html#cb451-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb451-15"><a href="analyses-de-survie.html#cb451-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> cow))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-315"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-315-1.png" alt="Résiduels de déviance en fonction du temps." width="672" />
<p class="caption">
Figure 9.18: Résiduels de déviance en fonction du temps.
</p>
</div>
<p>On note que les vaches 78 et 1 ont des résiduels assez larges (i.e. &gt; 3.0); les vaches 196 et 208 ont aussi des résiduels assez larges (i.e. entre 2.5 et 3.0). La vache 189 a, elle aussi, un résiduel assez large mais négatif. Évidemment, les résiduels positifs les plus larges sont des vaches qui ont conçu très rapidement (1 jour) suite au traitement (toutes placebo). Les vaches avec les résiduels négatifs les plus larges sont celles qui ont de très longs suivis sans conception (i.e. DAR large et PREG=0). Il ne semble pas y avoir de patron particulier pour ces vaches (lorsqu’on inspecte les tables directement:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="analyses-de-survie.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co">#En filtrant la table pour ne conserver que les résiduels standardisés larges</span></span>
<span id="cb452-2"><a href="analyses-de-survie.html#cb452-2" aria-hidden="true" tabindex="-1"></a>res_large <span class="ot">&lt;-</span> <span class="fu">subset</span>(pgtrial, </span>
<span id="cb452-3"><a href="analyses-de-survie.html#cb452-3" aria-hidden="true" tabindex="-1"></a>                    (resid_dev <span class="sc">&gt;=</span><span class="fl">2.5</span> <span class="sc">|</span> resid_dev<span class="sc">&lt;=-</span><span class="fl">2.5</span>)</span>
<span id="cb452-4"><a href="analyses-de-survie.html#cb452-4" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb452-5"><a href="analyses-de-survie.html#cb452-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-6"><a href="analyses-de-survie.html#cb452-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span> (res_large, </span>
<span id="cb452-7"><a href="analyses-de-survie.html#cb452-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Observations avec les résiduels les plus larges.&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb452-8"><a href="analyses-de-survie.html#cb452-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-316">Table 9.7: </span>Observations avec les résiduels les plus larges.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
herd
</th>
<th style="text-align:right;">
cow
</th>
<th style="text-align:right;">
tx
</th>
<th style="text-align:right;">
lact
</th>
<th style="text-align:left;">
thin
</th>
<th style="text-align:right;">
dar
</th>
<th style="text-align:right;">
preg
</th>
<th style="text-align:left;">
t_cat
</th>
<th style="text-align:right;">
lact_ct
</th>
<th style="text-align:right;">
lact_ct_sq
</th>
<th style="text-align:right;">
lact_ct_cu
</th>
<th style="text-align:right;">
res
</th>
<th style="text-align:left;">
t5
</th>
<th style="text-align:right;">
dar2
</th>
<th style="text-align:right;">
preg2
</th>
<th style="text-align:right;">
resid_dev
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9917920
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.731375
</td>
</tr>
<tr>
<td style="text-align:left;">
74
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9947488
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.858177
</td>
</tr>
<tr>
<td style="text-align:left;">
185
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
189
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
346
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
&gt;26 days
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-2.3808125
</td>
<td style="text-align:left;">
&gt;5 days
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.519159
</td>
</tr>
<tr>
<td style="text-align:left;">
192
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
196
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9183528
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.982147
</td>
</tr>
<tr>
<td style="text-align:left;">
204
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
208
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.8671546
</td>
<td style="text-align:left;">
0-5 days
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.564270
</td>
</tr>
</tbody>
</table>
<p>2.4. Quelles sont les observations les plus influentes sur les coefficients <span class="math inline">\(tx\)</span> et <span class="math inline">\(tx*time\)</span>? Ont-elles quelque chose en commun?</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="analyses-de-survie.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Créer les résiduels de déviance dans une table</span></span>
<span id="cb453-2"><a href="analyses-de-survie.html#cb453-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">resid</span>(PH_fit_pg_final, </span>
<span id="cb453-3"><a href="analyses-de-survie.html#cb453-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type=</span><span class="st">&quot;score&quot;</span>)</span>
<span id="cb453-4"><a href="analyses-de-survie.html#cb453-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb453-5"><a href="analyses-de-survie.html#cb453-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-6"><a href="analyses-de-survie.html#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Joindre ces éléments dans la table initiale</span></span>
<span id="cb453-7"><a href="analyses-de-survie.html#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Renommer les variables</span></span>
<span id="cb453-8"><a href="analyses-de-survie.html#cb453-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb453-9"><a href="analyses-de-survie.html#cb453-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(y, </span>
<span id="cb453-10"><a href="analyses-de-survie.html#cb453-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">old =</span> <span class="fu">c</span>(<span class="st">&#39;tx&#39;</span>,<span class="st">&#39;lact_ct&#39;</span>, <span class="st">&#39;lact_ct_sq&#39;</span>, <span class="st">&#39;thin1&#39;</span>, <span class="st">&#39;herd2&#39;</span>, <span class="st">&#39;herd3&#39;</span>, <span class="st">&#39;tx.t5.5.days&#39;</span>), </span>
<span id="cb453-11"><a href="analyses-de-survie.html#cb453-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">c</span>(<span class="st">&#39;score_tx&#39;</span>,<span class="st">&#39;score_lact_ct&#39;</span>, <span class="st">&#39;score_lact_ct_sq&#39;</span>,<span class="st">&#39;score_thin&#39;</span>, <span class="st">&#39;score_herd2&#39;</span>, <span class="st">&#39;score_herd3&#39;</span>, <span class="st">&#39;score_time_tx_inter&#39;</span>)</span>
<span id="cb453-12"><a href="analyses-de-survie.html#cb453-12" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb453-13"><a href="analyses-de-survie.html#cb453-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-14"><a href="analyses-de-survie.html#cb453-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Combiner les tables</span></span>
<span id="cb453-15"><a href="analyses-de-survie.html#cb453-15" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pgtrial, </span>
<span id="cb453-16"><a href="analyses-de-survie.html#cb453-16" aria-hidden="true" tabindex="-1"></a>           y</span>
<span id="cb453-17"><a href="analyses-de-survie.html#cb453-17" aria-hidden="true" tabindex="-1"></a>           ) </span>
<span id="cb453-18"><a href="analyses-de-survie.html#cb453-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-19"><a href="analyses-de-survie.html#cb453-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualiser résiduels de score de tx en fonction du temps</span></span>
<span id="cb453-20"><a href="analyses-de-survie.html#cb453-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb453-21"><a href="analyses-de-survie.html#cb453-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb453-22"><a href="analyses-de-survie.html#cb453-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>a, </span>
<span id="cb453-23"><a href="analyses-de-survie.html#cb453-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dar, </span>
<span id="cb453-24"><a href="analyses-de-survie.html#cb453-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>score_tx</span>
<span id="cb453-25"><a href="analyses-de-survie.html#cb453-25" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb453-26"><a href="analyses-de-survie.html#cb453-26" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb453-27"><a href="analyses-de-survie.html#cb453-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb453-28"><a href="analyses-de-survie.html#cb453-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb453-29"><a href="analyses-de-survie.html#cb453-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> cow))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-317"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-317-1.png" alt="Résiduels de score de la variable tx en fonction du temps." width="672" />
<p class="caption">
Figure 9.19: Résiduels de score de la variable tx en fonction du temps.
</p>
</div>
<p>Pour ce coefficient, les vaches 76, 184, 187, 188 et possiblement 189 et 323 semblent être des observations influentes (i.e. elles ont beaucoup d’impact sur les estimés de ce coefficient).</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="analyses-de-survie.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualiser résiduels de score de tx en fonction du temps</span></span>
<span id="cb454-2"><a href="analyses-de-survie.html#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb454-3"><a href="analyses-de-survie.html#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb454-4"><a href="analyses-de-survie.html#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>a, </span>
<span id="cb454-5"><a href="analyses-de-survie.html#cb454-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dar, </span>
<span id="cb454-6"><a href="analyses-de-survie.html#cb454-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>score_time_tx_inter</span>
<span id="cb454-7"><a href="analyses-de-survie.html#cb454-7" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb454-8"><a href="analyses-de-survie.html#cb454-8" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb454-9"><a href="analyses-de-survie.html#cb454-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb454-10"><a href="analyses-de-survie.html#cb454-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb454-11"><a href="analyses-de-survie.html#cb454-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> cow))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-318"></span>
<img src="Labo-R-Bookdown-project_files/figure-html/unnamed-chunk-318-1.png" alt="Résiduels de score de l'interaction tx par t5 (temps catégorique) en fonction du temps." width="672" />
<p class="caption">
Figure 9.20: Résiduels de score de l’interaction tx par t5 (temps catégorique) en fonction du temps.
</p>
</div>
<p>Ce sont les mêmes vaches qui sont influentes pour le coefficient de l’interaction. Ce sont toutes des vaches avec un nombre de jours de suivi élevé, la plupart (5/6) sont des observations censurées.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="régression-pour-données-de-compte-et-dincidence.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modèles-mixtes-pour-données-structurées.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Labo R Bookdown project.pdf", "Labo R Bookdown project.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
